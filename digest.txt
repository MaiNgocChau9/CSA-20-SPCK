Directory structure:
â””â”€â”€ CSA-20-SPCK/
    â”œâ”€â”€ README.md
    â”œâ”€â”€ app.py
    â”œâ”€â”€ disease-prediction-from-weather.ipynb
    â”œâ”€â”€ file.ipynb
    â”œâ”€â”€ requirements.txt
    â”œâ”€â”€ test.py
    â”œâ”€â”€ update-dataset.py
    â”œâ”€â”€ weather_information.ipynb
    â””â”€â”€ data/
        â””â”€â”€ global_climate_health_impact_tracker_2015_2025.csv
        â””â”€â”€ GlobalWeatherRepository.csv

================================================
FILE: README.md
================================================
# CSA-20-SPCK

## Quick start

1. Create a virtual environment and install dependencies:

```bash
python -m venv .venv
source .venv/bin/activate    # or `.venv\Scripts\activate` on Windows
pip install -r requirements.txt
```

2. Run the app:

```bash
streamlit run app.py
```

Files:
- `app.py` Ã¢â‚¬â€ main page
- `pages/1_Data_Analysis.py` Ã¢â‚¬â€ data exploration
- `pages/2_Input_Record.py` Ã¢â‚¬â€ append rows to CSV
- `pages/3_Prediction.py` Ã¢â‚¬â€ simple training / evaluation / predict
- `datamodules/DataModule.py` Ã¢â‚¬â€ minimal helper to read/visualize CSV
- `config.py` Ã¢â‚¬â€ path constants


================================================
FILE: app.py
================================================
"""
á»¨ng dá»¥ng PhÃ¢n tÃ­ch KhÃ­ háº­u vÃ  Sá»©c khá»e
Dá»± Ä‘oÃ¡n tÃ¡c Ä‘á»™ng cá»§a khÃ­ háº­u Ä‘áº¿n sá»©c khá»e con ngÆ°á»i
"""

import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
import requests

# Cáº¥u hÃ¬nh scikit-learn
from sklearn.linear_model import LinearRegression
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_squared_error, r2_score

# ===== Cáº¤U HÃŒNH TRANG =====
st.set_page_config(
    page_title="PhÃ¢n tÃ­ch KhÃ­ háº­u & Sá»©c khá»e",
    page_icon="ğŸŒ",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ===== HÃ€M TIá»†N ÃCH =====
@st.cache_data
def load_health_data():
    """Táº£i dá»¯ liá»‡u khÃ­ háº­u vÃ  sá»©c khá»e"""
    try:
        df = pd.read_csv('data/global_climate_health_impact_tracker_2015_2025.csv')
        df['date'] = pd.to_datetime(df['date'])
        return df
    except FileNotFoundError:
        st.error("âŒ KhÃ´ng tÃ¬m tháº¥y file dá»¯ liá»‡u sá»©c khá»e!")
        return None

@st.cache_data
def load_weather_data():
    """Táº£i dá»¯ liá»‡u thá»i tiáº¿t toÃ n cáº§u"""
    try:
        df = pd.read_csv('data/GlobalWeatherRepository.csv')
        df['last_updated'] = pd.to_datetime(df['last_updated'])
        return df
    except FileNotFoundError:
        st.error("âŒ KhÃ´ng tÃ¬m tháº¥y file dá»¯ liá»‡u thá»i tiáº¿t!")
        return None

@st.cache_data
def analyze_correlations(df):
    """PhÃ¢n tÃ­ch tÆ°Æ¡ng quan chi tiáº¿t giá»¯a cÃ¡c biáº¿n"""
    correlations = {}
    
    # TÆ°Æ¡ng quan PM2.5 vá»›i bá»‡nh hÃ´ háº¥p
    correlations['pm25_respiratory'] = df[['pm25_ugm3', 'respiratory_disease_rate']].corr().iloc[0, 1]
    
    # TÆ°Æ¡ng quan nhiá»‡t Ä‘á»™ vá»›i bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian
    correlations['temp_vector'] = df[['temperature_celsius', 'vector_disease_risk_score']].corr().iloc[0, 1]
    
    # TÆ°Æ¡ng quan náº¯ng nÃ³ng vá»›i ca nháº­p viá»‡n
    correlations['heat_admission'] = df[['heat_wave_days', 'heat_related_admissions']].corr().iloc[0, 1]
    
    # TÆ°Æ¡ng quan cháº¥t lÆ°á»£ng khÃ´ng khÃ­ vá»›i sá»©c khá»e tim máº¡ch
    correlations['aqi_cardio'] = df[['air_quality_index', 'cardio_mortality_rate']].corr().iloc[0, 1]
    
    return correlations

@st.cache_data
def generate_research_findings(df):
    """Táº¡o cÃ¡c phÃ¡t hiá»‡n nghiÃªn cá»©u tá»« dá»¯ liá»‡u"""
    findings = []
    
    # 1. PhÃ¢n tÃ­ch PM2.5 vÃ  bá»‡nh hÃ´ háº¥p
    pm25_high = df[df['pm25_ugm3'] > 50]
    pm25_low = df[df['pm25_ugm3'] <= 50]
    resp_diff = pm25_high['respiratory_disease_rate'].mean() - pm25_low['respiratory_disease_rate'].mean()
    
    findings.append({
        'Danh má»¥c': 'Cháº¥t lÆ°á»£ng KhÃ´ng khÃ­',
        'PhÃ¡t hiá»‡n': f'Tá»· lá»‡ bá»‡nh hÃ´ háº¥p cao hÆ¡n {resp_diff:.1f}% khi PM2.5 > 50 Î¼g/mÂ³',
        'TÃ¡c Ä‘á»™ng': 'Cao' if resp_diff > 10 else 'Trung bÃ¬nh',
        'Sá»‘ máº«u': len(pm25_high),
        'Äá»™ tin cáº­y': 'Cao'
    })
    
    # 2. PhÃ¢n tÃ­ch nhiá»‡t Ä‘á»™ vÃ  bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian
    temp_high = df[df['temperature_celsius'] > 25]
    vector_high = temp_high['vector_disease_risk_score'].mean()
    vector_low = df[df['temperature_celsius'] <= 25]['vector_disease_risk_score'].mean()
    vector_diff = vector_high - vector_low
    
    findings.append({
        'Danh má»¥c': 'Nhiá»‡t Ä‘á»™ & Sinh váº­t trung gian',
        'PhÃ¡t hiá»‡n': f'Rá»§i ro bá»‡nh tÄƒng {vector_diff:.1f} Ä‘iá»ƒm khi nhiá»‡t Ä‘á»™ > 25Â°C',
        'TÃ¡c Ä‘á»™ng': 'Cao' if vector_diff > 1 else 'Trung bÃ¬nh',
        'Sá»‘ máº«u': len(temp_high),
        'Äá»™ tin cáº­y': 'Cao'
    })
    
    # 3. PhÃ¢n tÃ­ch náº¯ng nÃ³ng vÃ  ca nháº­p viá»‡n
    heat_wave = df[df['heat_wave_days'] > 0]
    admission_ratio = heat_wave['heat_related_admissions'].mean() / df['heat_related_admissions'].mean()
    
    findings.append({
        'Danh má»¥c': 'Náº¯ng nÃ³ng',
        'PhÃ¡t hiá»‡n': f'Ca nháº­p viá»‡n tÄƒng {(admission_ratio - 1) * 100:.1f}% trong Ä‘á»£t náº¯ng nÃ³ng',
        'TÃ¡c Ä‘á»™ng': 'Ráº¥t cao' if admission_ratio > 2 else 'Cao',
        'Sá»‘ máº«u': len(heat_wave),
        'Äá»™ tin cáº­y': 'Cao'
    })
    
    # 4. PhÃ¢n tÃ­ch thá»i tiáº¿t cá»±c Ä‘oan
    extreme = df[df['extreme_weather_events'] > 0]
    health_impact = extreme[['respiratory_disease_rate', 'cardio_mortality_rate', 
                            'vector_disease_risk_score']].mean().mean()
    normal_health = df[df['extreme_weather_events'] == 0][
        ['respiratory_disease_rate', 'cardio_mortality_rate', 'vector_disease_risk_score']
    ].mean().mean()
    
    findings.append({
        'Danh má»¥c': 'Thá»i tiáº¿t Cá»±c Ä‘oan',
        'PhÃ¡t hiá»‡n': f'TÃ¡c Ä‘á»™ng sá»©c khá»e tá»•ng thá»ƒ tÄƒng {((health_impact/normal_health - 1) * 100):.1f}%',
        'TÃ¡c Ä‘á»™ng': 'Ráº¥t cao',
        'Sá»‘ máº«u': len(extreme),
        'Äá»™ tin cáº­y': 'Cao'
    })
    
    return pd.DataFrame(findings)

@st.cache_data
def calculate_model_metrics(df):
    """TÃ­nh toÃ¡n cÃ¡c chá»‰ sá»‘ cho tá»«ng mÃ´ hÃ¬nh"""
    metrics = []
    
    # Model 1: Respiratory Disease
    X = df[['pm25_ugm3', 'air_quality_index']].dropna()
    y = df.loc[X.index, 'respiratory_disease_rate']
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
    model = LinearRegression()
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    
    metrics.append({
        'MÃ´ hÃ¬nh': 'Bá»‡nh HÃ´ háº¥p',
        'Thuáº­t toÃ¡n': 'Linear Regression',
        'Äáº·c trÆ°ng': 'PM2.5, AQI',
        'RÂ² Score': r2_score(y_test, y_pred),
        'RMSE': np.sqrt(mean_squared_error(y_test, y_pred)),
        'Sá»‘ máº«u': len(X)
    })
    
    # Model 2: Vector Disease
    X = df[['temperature_celsius', 'precipitation_mm', 'heat_related_admissions']].dropna()
    y = df.loc[X.index, 'vector_disease_risk_score']
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
    model = RandomForestRegressor(n_estimators=100, random_state=42)
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    
    metrics.append({
        'MÃ´ hÃ¬nh': 'Bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian',
        'Thuáº­t toÃ¡n': 'Random Forest',
        'Äáº·c trÆ°ng': 'Nhiá»‡t Ä‘á»™, MÆ°a, Ca nháº­p viá»‡n',
        'RÂ² Score': r2_score(y_test, y_pred),
        'RMSE': np.sqrt(mean_squared_error(y_test, y_pred)),
        'Sá»‘ máº«u': len(X)
    })
    
    # Model 3: Heat-related Admissions
    X = df[['temperature_celsius', 'precipitation_mm', 'heat_wave_days', 'extreme_weather_events']].dropna()
    y = df.loc[X.index, 'heat_related_admissions']
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
    model = LinearRegression()
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    
    metrics.append({
        'MÃ´ hÃ¬nh': 'Ca Nháº­p viá»‡n do Náº¯ng',
        'Thuáº­t toÃ¡n': 'Linear Regression',
        'Äáº·c trÆ°ng': 'Nhiá»‡t Ä‘á»™, MÆ°a, Náº¯ng nÃ³ng, Cá»±c Ä‘oan',
        'RÂ² Score': r2_score(y_test, y_pred),
        'RMSE': np.sqrt(mean_squared_error(y_test, y_pred)),
        'Sá»‘ máº«u': len(X)
    })
    
    return pd.DataFrame(metrics)

def train_respiratory_model(df):
    """Huáº¥n luyá»‡n mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n bá»‡nh hÃ´ háº¥p"""
    features = ['pm25_ugm3', 'air_quality_index']
    X = df[features].dropna()
    y = df.loc[X.index, 'respiratory_disease_rate']
    
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
    model = LinearRegression()
    model.fit(X_train, y_train)
    
    y_pred = model.predict(X_test)
    rmse = np.sqrt(mean_squared_error(y_test, y_pred))
    r2 = r2_score(y_test, y_pred)
    
    return model, rmse, r2, X_test, y_test, y_pred

def train_vector_disease_model(df):
    """Huáº¥n luyá»‡n mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian"""
    features = ['temperature_celsius', 'precipitation_mm', 'heat_related_admissions']
    X = df[features].dropna()
    y = df.loc[X.index, 'vector_disease_risk_score']
    
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
    model = RandomForestRegressor(n_estimators=100, random_state=42)
    model.fit(X_train, y_train)
    
    y_pred = model.predict(X_test)
    rmse = np.sqrt(mean_squared_error(y_test, y_pred))
    r2 = r2_score(y_test, y_pred)
    
    return model, rmse, r2, X_test, y_test, y_pred

def train_heat_admission_model(df):
    """Huáº¥n luyá»‡n mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n ca nháº­p viá»‡n do náº¯ng nÃ³ng"""
    features = ['temperature_celsius', 'precipitation_mm', 'heat_wave_days', 'extreme_weather_events']
    X = df[features].dropna()
    y = df.loc[X.index, 'heat_related_admissions']
    
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
    model = LinearRegression()
    model.fit(X_train, y_train)
    
    y_pred = model.predict(X_test)
    rmse = np.sqrt(mean_squared_error(y_test, y_pred))
    r2 = r2_score(y_test, y_pred)
    
    return model, rmse, r2, X_test, y_test, y_pred

def train_temperature_model(df):
    """Huáº¥n luyá»‡n mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n nhiá»‡t Ä‘á»™ tá»« dá»¯ liá»‡u thá»i tiáº¿t"""
    df['hour'] = df['last_updated'].dt.hour
    features = ['latitude', 'humidity', 'pressure_mb', 'wind_kph', 'cloud', 'hour']
    
    data = df[features + ['temperature_celsius']].dropna()
    X = data[features]
    y = data['temperature_celsius']
    
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
    model = RandomForestRegressor(n_estimators=100, random_state=42)
    model.fit(X_train, y_train)
    
    y_pred = model.predict(X_test)
    rmse = np.sqrt(mean_squared_error(y_test, y_pred))
    r2 = r2_score(y_test, y_pred)
    
    return model, rmse, r2, features

def get_realtime_weather(lat, lon):
    """Láº¥y dá»¯ liá»‡u thá»i tiáº¿t thá»±c táº¿ tá»« Open-Meteo API"""
    url = f"https://api.open-meteo.com/v1/forecast?latitude={lat}&longitude={lon}&current=relative_humidity_2m,surface_pressure,wind_speed_10m,cloud_cover&timezone=auto"
    
    try:
        response = requests.get(url, timeout=10)
        data = response.json()
        current = data['current']
        
        return {
            'latitude': lat,
            'humidity': current['relative_humidity_2m'],
            'pressure_mb': current['surface_pressure'],
            'wind_kph': current['wind_speed_10m'] * 3.6,
            'cloud': current['cloud_cover'],
            'hour': datetime.now().hour
        }
    except Exception as e:
        st.error(f"âŒ Lá»—i khi láº¥y dá»¯ liá»‡u thá»i tiáº¿t: {e}")
        return None

# ===== GIAO DIá»†N CHÃNH =====
def main():
    # Header
    st.title("ğŸŒ PhÃ¢n tÃ­ch TÃ¡c Ä‘á»™ng KhÃ­ háº­u lÃªn Sá»©c khá»e")
    st.divider()
    
    # Sidebar
    with st.sidebar:
        st.title("ğŸ“Š Menu Äiá»u hÆ°á»›ng")
        
        menu = st.radio(
            "Chá»n chá»©c nÄƒng:",
            ["ğŸ  Tá»•ng quan", "ğŸ“ˆ PhÃ¢n tÃ­ch & BÃ¡o cÃ¡o", "ğŸ”¬ Dá»± Ä‘oÃ¡n Bá»‡nh", 
             "ğŸŒ¡ï¸ Dá»± Ä‘oÃ¡n Nhiá»‡t Ä‘á»™", "â„¹ï¸ HÆ°á»›ng dáº«n"],
            label_visibility="collapsed"
        )
        
        st.divider()
        st.info("ğŸ’¡ Sá»­ dá»¥ng menu Ä‘á»ƒ khÃ¡m phÃ¡ cÃ¡c tÃ­nh nÄƒng")
    
    # ===== TRANG Tá»”NG QUAN =====
    if menu == "ğŸ  Tá»•ng quan":
        st.header("ğŸ“‹ Giá»›i thiá»‡u Dá»± Ã¡n")
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.subheader("ğŸ¯ Má»¥c tiÃªu")
            st.write("""
            Dá»± Ã¡n phÃ¢n tÃ­ch vÃ  dá»± Ä‘oÃ¡n tÃ¡c Ä‘á»™ng cá»§a biáº¿n Ä‘á»•i khÃ­ háº­u Ä‘áº¿n sá»©c khá»e:
            
            - **Bá»‡nh hÃ´ háº¥p** tá»« PM2.5 vÃ  chá»‰ sá»‘ cháº¥t lÆ°á»£ng khÃ´ng khÃ­
            - **Bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian** tá»« nhiá»‡t Ä‘á»™ vÃ  lÆ°á»£ng mÆ°a
            - **Ca nháº­p viá»‡n** do náº¯ng nÃ³ng
            - **Nhiá»‡t Ä‘á»™** tá»« dá»¯ liá»‡u khÃ­ tÆ°á»£ng thá»±c táº¿
            """)
        
        with col2:
            st.subheader("ğŸ“Š Dá»¯ liá»‡u")
            st.write("""
            Hai nguá»“n dá»¯ liá»‡u chÃ­nh:
            
            - **Global Climate Health Impact Tracker (2015-2025)**: 14,100 báº£n ghi
            - **Global Weather Repository**: Dá»¯ liá»‡u tá»« 195 quá»‘c gia
            
            Tá»•ng cá»™ng hÆ¡n **30 biáº¿n sá»‘** Ä‘Æ°á»£c phÃ¢n tÃ­ch
            """)
        
        # Thá»‘ng kÃª tá»•ng quan
        health_df = load_health_data()
        weather_df = load_weather_data()
        
        if health_df is not None and weather_df is not None:
            st.divider()
            st.subheader("ğŸ“Š Thá»‘ng kÃª Tá»•ng quan")
            
            col1, col2, col3, col4 = st.columns(4)
            
            with col1:
                st.metric("ğŸ—‚ï¸ Báº£n ghi Sá»©c khá»e", f"{len(health_df):,}")
            with col2:
                st.metric("ğŸŒ Quá»‘c gia", health_df['country_name'].nunique())
            with col3:
                st.metric("ğŸ“ Äá»‹a Ä‘iá»ƒm Thá»i tiáº¿t", len(weather_df))
            with col4:
                st.metric("ğŸ“… NÄƒm PhÃ¢n tÃ­ch", f"{health_df['year'].min()}-{health_df['year'].max()}")
    
    # ===== TRANG PHÃ‚N TÃCH & BÃO CÃO =====
    elif menu == "ğŸ“ˆ PhÃ¢n tÃ­ch & BÃ¡o cÃ¡o":
        st.header("ğŸ“ˆ PhÃ¢n tÃ­ch Dá»¯ liá»‡u & BÃ¡o cÃ¡o NghiÃªn cá»©u")
        
        health_df = load_health_data()
        
        if health_df is not None:
            # Táº¡o tabs
            tab1, tab2, tab3, tab4, tab5 = st.tabs([
                "ğŸ“Š Tá»•ng quan", 
                "ğŸ“‹ BÃ¡o cÃ¡o NghiÃªn cá»©u", 
                "ğŸ”¥ TÆ°Æ¡ng quan",
                "ğŸ“ˆ Hiá»‡u suáº¥t MÃ´ hÃ¬nh",
                "ğŸ“‰ Xu hÆ°á»›ng"
            ])
            
            # ===== TAB 1: Tá»”NG QUAN =====
            with tab1:
                st.subheader("ğŸ“‹ ThÃ´ng tin Dá»¯ liá»‡u")
                
                col1, col2, col3 = st.columns(3)
                with col1:
                    st.metric("ğŸ“Š Tá»•ng báº£n ghi", f"{len(health_df):,}")
                with col2:
                    st.metric("ğŸ”¢ Sá»‘ cá»™t", len(health_df.columns))
                with col3:
                    st.metric("ğŸŒ Sá»‘ quá»‘c gia", health_df['country_name'].nunique())
                
                st.divider()
                
                col1, col2 = st.columns(2)
                
                with col1:
                    st.write("**ğŸ” Dá»¯ liá»‡u máº«u:**")
                    st.dataframe(health_df.head(10), use_container_width=True, height=400)
                
                with col2:
                    st.write("**ğŸ“Š Thá»‘ng kÃª MÃ´ táº£:**")
                    st.dataframe(health_df.describe().T, use_container_width=True, height=400)
                
                st.divider()
                st.write("**ğŸ“ ThÃ´ng tin Cá»™t:**")
                
                col_info = []
                for col in health_df.columns:
                    col_info.append({
                        'TÃªn cá»™t': col,
                        'Kiá»ƒu': str(health_df[col].dtype),
                        'Null': health_df[col].isnull().sum(),
                        '% Null': f"{(health_df[col].isnull().sum() / len(health_df) * 100):.2f}%",
                        'Unique': health_df[col].nunique()
                    })
                
                st.dataframe(pd.DataFrame(col_info), use_container_width=True, height=400)
            
            # ===== TAB 2: BÃO CÃO NGHIÃŠN Cá»¨U =====
            with tab2:
                st.subheader("ğŸ“‹ Káº¿t quáº£ NghiÃªn cá»©u")
                
                with st.spinner("â³ Äang phÃ¢n tÃ­ch dá»¯ liá»‡u..."):
                    findings_df = generate_research_findings(health_df)
                    correlations = analyze_correlations(health_df)
                
                # TÃ³m táº¯t
                st.info(f"""
                **PhÃ¢n tÃ­ch {len(health_df):,} báº£n ghi** tá»« **{health_df['country_name'].nunique()} quá»‘c gia** 
                trong giai Ä‘oáº¡n **{health_df['year'].min()}-{health_df['year'].max()}**
                """)
                
                st.divider()
                
                # CÃ¡c phÃ¡t hiá»‡n chÃ­nh
                st.subheader("ğŸ” CÃ¡c PhÃ¡t hiá»‡n ChÃ­nh")
                
                # PhÃ¡t hiá»‡n 1: PM2.5 vÃ  Bá»‡nh hÃ´ háº¥p
                pm25_high = health_df[health_df['pm25_ugm3'] > 50]
                pm25_low = health_df[health_df['pm25_ugm3'] <= 50]
                resp_diff = pm25_high['respiratory_disease_rate'].mean() - pm25_low['respiratory_disease_rate'].mean()
                
                st.write("**1ï¸âƒ£ Cháº¥t lÆ°á»£ng KhÃ´ng khÃ­ vÃ  Bá»‡nh HÃ´ háº¥p**")
                st.info(f"""
                **PhÃ¡t hiá»‡n:** Tá»· lá»‡ bá»‡nh hÃ´ háº¥p cao hÆ¡n **{resp_diff:.1f}%** khi PM2.5 > 50 Î¼g/mÂ³
                
                **CÃ¡ch thá»©c tÃ¡c Ä‘á»™ng:**
                - **PM2.5** (bá»¥i má»‹n): Háº¡t bá»¥i nhá» hÆ¡n 2.5 micromet xÃ¢m nháº­p sÃ¢u vÃ o phá»•i, gÃ¢y viÃªm Ä‘Æ°á»ng hÃ´ háº¥p
                - **Chá»‰ sá»‘ cháº¥t lÆ°á»£ng khÃ´ng khÃ­ (AQI)**: Pháº£n Ã¡nh tá»•ng há»£p cÃ¡c cháº¥t Ã´ nhiá»…m, áº£nh hÆ°á»Ÿng trá»±c tiáº¿p Ä‘áº¿n há»‡ hÃ´ háº¥p
                - Khi PM2.5 vÆ°á»£t ngÆ°á»¡ng 50 Î¼g/mÂ³, nguy cÆ¡ máº¯c cÃ¡c bá»‡nh nhÆ° hen suyá»…n, viÃªm pháº¿ quáº£n tÄƒng Ä‘Ã¡ng ká»ƒ
                
                **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng:** {'Cao' if resp_diff > 10 else 'Trung bÃ¬nh'} | **Sá»‘ máº«u phÃ¢n tÃ­ch:** {len(pm25_high):,}
                """)
                
                # PhÃ¡t hiá»‡n 2: Nhiá»‡t Ä‘á»™ vÃ  Bá»‡nh sinh váº­t trung gian
                temp_high = health_df[health_df['temperature_celsius'] > 25]
                vector_high = temp_high['vector_disease_risk_score'].mean()
                vector_low = health_df[health_df['temperature_celsius'] <= 25]['vector_disease_risk_score'].mean()
                vector_diff = vector_high - vector_low
                
                st.write("**2ï¸âƒ£ Nhiá»‡t Ä‘á»™ vÃ  Bá»‡nh lÃ¢y truyá»n qua Sinh váº­t trung gian**")
                st.info(f"""
                **PhÃ¡t hiá»‡n:** Äiá»ƒm rá»§i ro bá»‡nh tÄƒng **{vector_diff:.1f} Ä‘iá»ƒm** khi nhiá»‡t Ä‘á»™ > 25Â°C
                
                **CÃ¡ch thá»©c tÃ¡c Ä‘á»™ng:**
                - **Nhiá»‡t Ä‘á»™**: MÃ´i trÆ°á»ng áº¥m (>25Â°C) táº¡o Ä‘iá»u kiá»‡n thuáº­n lá»£i cho muá»—i, ruá»“i vÃ  cÃ¡c sinh váº­t trung gian sinh sáº£n nhanh
                - **LÆ°á»£ng mÆ°a**: Táº¡o vÅ©ng nÆ°á»›c Ä‘á»ng - nÆ¡i sinh sáº£n lÃ½ tÆ°á»Ÿng cho muá»—i truyá»n bá»‡nh sá»‘t rÃ©t, sá»‘t xuáº¥t huyáº¿t
                - **Ca nháº­p viá»‡n liÃªn quan náº¯ng nÃ³ng**: Chá»‰ bÃ¡o giÃ¡n tiáº¿p vá» Ä‘iá»u kiá»‡n khÃ­ háº­u thuáº­n lá»£i cho dá»‹ch bá»‡nh
                - Chu ká»³ sinh trÆ°á»Ÿng cá»§a muá»—i rÃºt ngáº¯n tá»« 10 ngÃ y xuá»‘ng 7 ngÃ y khi nhiá»‡t Ä‘á»™ tÄƒng
                
                **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng:** {'Cao' if vector_diff > 1 else 'Trung bÃ¬nh'} | **Sá»‘ máº«u phÃ¢n tÃ­ch:** {len(temp_high):,}
                """)
                
                # PhÃ¡t hiá»‡n 3: Náº¯ng nÃ³ng vÃ  Ca nháº­p viá»‡n
                heat_wave = health_df[health_df['heat_wave_days'] > 0]
                admission_ratio = heat_wave['heat_related_admissions'].mean() / health_df['heat_related_admissions'].mean()
                
                st.write("**3ï¸âƒ£ Náº¯ng nÃ³ng vÃ  Ca Nháº­p viá»‡n**")
                st.info(f"""
                **PhÃ¡t hiá»‡n:** Ca nháº­p viá»‡n tÄƒng **{(admission_ratio - 1) * 100:.1f}%** trong Ä‘á»£t náº¯ng nÃ³ng
                
                **CÃ¡ch thá»©c tÃ¡c Ä‘á»™ng:**
                - **Sá»‘ ngÃ y náº¯ng nÃ³ng**: CÆ¡ thá»ƒ pháº£i Ä‘iá»u hÃ²a nhiá»‡t liÃªn tá»¥c, gÃ¢y má»‡t má»i vÃ  suy giáº£m chá»©c nÄƒng
                - **Nhiá»‡t Ä‘á»™ cao**: GÃ¢y máº¥t nÆ°á»›c, sá»‘c nhiá»‡t, Ä‘á»™t quá»µ nhiá»‡t á»Ÿ ngÆ°á»i giÃ  vÃ  tráº» em
                - **LÆ°á»£ng mÆ°a tháº¥p**: LÃ m tÄƒng ná»“ng Ä‘á»™ Ã´ nhiá»…m khÃ´ng khÃ­, tÄƒng gÃ¡nh náº·ng cho há»‡ hÃ´ háº¥p
                - **Sá»± kiá»‡n thá»i tiáº¿t cá»±c Ä‘oan**: Äá»£t nÃ³ng kÃ©o dÃ i khiáº¿n cÆ¡ thá»ƒ khÃ´ng ká»‹p thÃ­ch nghi
                
                **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng:** {'Ráº¥t cao' if admission_ratio > 2 else 'Cao'} | **Sá»‘ máº«u phÃ¢n tÃ­ch:** {len(heat_wave):,}
                """)
                
                # PhÃ¡t hiá»‡n 4: Thá»i tiáº¿t cá»±c Ä‘oan
                extreme = health_df[health_df['extreme_weather_events'] > 0]
                health_impact = extreme[['respiratory_disease_rate', 'cardio_mortality_rate', 
                                        'vector_disease_risk_score']].mean().mean()
                normal_health = health_df[health_df['extreme_weather_events'] == 0][
                    ['respiratory_disease_rate', 'cardio_mortality_rate', 'vector_disease_risk_score']
                ].mean().mean()
                
                st.write("**4ï¸âƒ£ Thá»i tiáº¿t Cá»±c Ä‘oan**")
                st.info(f"""
                **PhÃ¡t hiá»‡n:** TÃ¡c Ä‘á»™ng sá»©c khá»e tá»•ng thá»ƒ tÄƒng **{((health_impact/normal_health - 1) * 100):.1f}%**
                
                **CÃ¡ch thá»©c tÃ¡c Ä‘á»™ng:**
                - **BÃ£o, lÅ© lá»¥t**: PhÃ¡ há»§y cÆ¡ sá»Ÿ háº¡ táº§ng y táº¿, Ã´ nhiá»…m nguá»“n nÆ°á»›c, lan truyá»n dá»‹ch bá»‡nh
                - **Háº¡n hÃ¡n**: Thiáº¿u nÆ°á»›c sáº¡ch, suy dinh dÆ°á»¡ng, bá»‡nh truyá»n nhiá»…m qua Ä‘Æ°á»ng tiÃªu hÃ³a
                - **SÃ³ng nhiá»‡t**: GÃ¢y stress nhiá»‡t, tÄƒng tá»­ vong do bá»‡nh tim máº¡ch
                - CÃ¡c sá»± kiá»‡n cá»±c Ä‘oan thÆ°á»ng Ä‘i kÃ¨m nhau (háº¡n hÃ¡n + náº¯ng nÃ³ng, bÃ£o + lÅ©), gÃ¢y tÃ¡c Ä‘á»™ng kÃ©p
                
                **Má»©c Ä‘á»™ tÃ¡c Ä‘á»™ng:** Ráº¥t cao | **Sá»‘ máº«u phÃ¢n tÃ­ch:** {len(extreme):,}
                """)
                
                # Tá»•ng káº¿t báº±ng expander
                with st.expander("ğŸ“Š Xem Báº£ng TÃ³m táº¯t PhÃ¡t hiá»‡n"):
                    summary_df = findings_df
                    st.dataframe(summary_df, use_container_width=True)
                
                st.divider()
                
                # Há»‡ sá»‘ tÆ°Æ¡ng quan
                st.subheader("ğŸ“Š Há»‡ sá»‘ TÆ°Æ¡ng quan Chi tiáº¿t")
                
                corr_cols = st.columns(2)
                
                with corr_cols[0]:
                    st.metric("ğŸŒ«ï¸ PM2.5 â†” Bá»‡nh HÃ´ háº¥p", f"{correlations['pm25_respiratory']:.3f}")
                    st.caption("PM2.5 tÄƒng â†’ tá»· lá»‡ bá»‡nh hÃ´ háº¥p tÄƒng")
                    
                    st.metric("ğŸ¦Ÿ Nhiá»‡t Ä‘á»™ â†” Bá»‡nh qua sinh váº­t trung gian", f"{correlations['temp_vector']:.3f}")
                    st.caption("Nhiá»‡t Ä‘á»™ cao â†’ rá»§i ro bá»‡nh tÄƒng")
                
                with corr_cols[1]:
                    st.metric("ğŸ”¥ Náº¯ng nÃ³ng â†” Ca Nháº­p viá»‡n", f"{correlations['heat_admission']:.3f}")
                    st.caption("Náº¯ng nÃ³ng â†’ ca nháº­p viá»‡n tÄƒng")
                
                st.divider()
                
                # PhÃ¢n tÃ­ch theo vÃ¹ng
                st.subheader("ğŸŒ PhÃ¢n tÃ­ch theo Khu vá»±c")
                
                region_stats = health_df.groupby('region').agg({
                    'respiratory_disease_rate': 'mean',
                    'vector_disease_risk_score': 'mean',
                    'heat_related_admissions': 'mean',
                    'temperature_celsius': 'mean',
                    'pm25_ugm3': 'mean'
                }).round(2)
                
                st.dataframe(region_stats, use_container_width=True)
                
                # Biá»ƒu Ä‘á»“
                fig, axes = plt.subplots(1, 2, figsize=(14, 5))
                
                region_stats['respiratory_disease_rate'].plot(kind='barh', ax=axes[0], color='steelblue')
                axes[0].set_title('Tá»· lá»‡ Bá»‡nh HÃ´ háº¥p theo VÃ¹ng')
                axes[0].set_xlabel('Tá»· lá»‡ (%)')
                axes[0].grid(True, alpha=0.3)
                
                region_stats['vector_disease_risk_score'].plot(kind='barh', ax=axes[1], color='coral')
                axes[1].set_title('Äiá»ƒm Rá»§i ro Bá»‡nh Vector theo VÃ¹ng')
                axes[1].set_xlabel('Äiá»ƒm rá»§i ro')
                axes[1].grid(True, alpha=0.3)
                
                plt.tight_layout()
                st.pyplot(fig)
                plt.close()
                
                st.divider()
                
                # Káº¿t luáº­n
                st.subheader("ğŸ’¡ Káº¿t luáº­n")
                
                st.success("""
                **Káº¿t luáº­n chÃ­nh:**
                
                1. Cháº¥t lÆ°á»£ng khÃ´ng khÃ­ cÃ³ tÃ¡c Ä‘á»™ng trá»±c tiáº¿p Ä‘áº¿n bá»‡nh hÃ´ háº¥p
                2. Biáº¿n Ä‘á»•i khÃ­ háº­u lÃ m tÄƒng rá»§i ro bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian
                3. Hiá»‡n tÆ°á»£ng náº¯ng nÃ³ng ngÃ y cÃ ng nghiÃªm trá»ng
                4. Thá»i tiáº¿t cá»±c Ä‘oan áº£nh hÆ°á»Ÿng Ä‘a chiá»u Ä‘áº¿n sá»©c khá»e
                """)
                
                st.warning("""
                **Khuyáº¿n nghá»‹:**
                
                - TÄƒng cÆ°á»ng giÃ¡m sÃ¡t cháº¥t lÆ°á»£ng khÃ´ng khÃ­
                - Chuáº©n bá»‹ nguá»“n lá»±c y táº¿ cho khu vá»±c nguy cÆ¡ cao
                - NÃ¢ng cao nháº­n thá»©c cá»™ng Ä‘á»“ng
                - Tiáº¿p tá»¥c nghiÃªn cá»©u vÃ  phÃ¡t triá»ƒn mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n
                """)
            
            # ===== TAB 3: TÆ¯Æ NG QUAN =====
            with tab3:
                st.subheader("ğŸ”¥ Ma tráº­n TÆ°Æ¡ng quan")
                
                numeric_cols = health_df.select_dtypes(include=[np.number]).columns.tolist()
                
                default_vars = ['temperature_celsius', 'pm25_ugm3', 'respiratory_disease_rate', 
                               'vector_disease_risk_score', 'heat_related_admissions',
                               'air_quality_index', 'precipitation_mm', 'cardio_mortality_rate']
                default_vars = [v for v in default_vars if v in numeric_cols]
                
                selected_cols = st.multiselect(
                    "Chá»n biáº¿n:",
                    numeric_cols,
                    default=default_vars[:min(10, len(default_vars))]
                )
                
                if selected_cols:
                    correlation = health_df[selected_cols].corr()
                    
                    with st.expander("ğŸ“Š Xem Ma tráº­n Sá»‘"):
                        st.dataframe(correlation.style.format("{:.3f}"), use_container_width=True)
                    
                    # Heatmap
                    fig, ax = plt.subplots(figsize=(12, 10))
                    sns.heatmap(correlation, annot=True, cmap='coolwarm', center=0,
                               fmt='.2f', ax=ax, square=True, linewidths=0.5)
                    plt.title('Ma tráº­n TÆ°Æ¡ng quan', pad=20)
                    plt.tight_layout()
                    st.pyplot(fig)
                    plt.close()
                    
                    # CÃ¡c cáº·p tÆ°Æ¡ng quan cao
                    st.divider()
                    st.subheader("ğŸ” TÆ°Æ¡ng quan Cao (|r| > 0.5)")
                    
                    high_corr = []
                    for i in range(len(correlation.columns)):
                        for j in range(i+1, len(correlation.columns)):
                            corr_val = correlation.iloc[i, j]
                            if abs(corr_val) > 0.5:
                                high_corr.append({
                                    'Biáº¿n 1': correlation.columns[i],
                                    'Biáº¿n 2': correlation.columns[j],
                                    'Há»‡ sá»‘': corr_val,
                                    'Loáº¡i': 'DÆ°Æ¡ng' if corr_val > 0 else 'Ã‚m'
                                })
                    
                    if high_corr:
                        st.dataframe(
                            pd.DataFrame(high_corr).sort_values('Há»‡ sá»‘', key=abs, ascending=False),
                            use_container_width=True
                        )
                    else:
                        st.info("KhÃ´ng cÃ³ cáº·p biáº¿n nÃ o cÃ³ |r| > 0.5")
                else:
                    st.warning("âš ï¸ Vui lÃ²ng chá»n Ã­t nháº¥t má»™t biáº¿n")
            
            # ===== TAB 4: HIá»†U SUáº¤T MÃ” HÃŒNH =====
            with tab4:
                st.subheader("ğŸ“ˆ ÄÃ¡nh giÃ¡ MÃ´ hÃ¬nh")
                
                with st.spinner("â³ Äang tÃ­nh toÃ¡n..."):
                    metrics_df = calculate_model_metrics(health_df)
                
                st.dataframe(
                    metrics_df.style.format({
                        'RÂ² Score': '{:.4f}',
                        'RMSE': '{:.4f}',
                        'Sá»‘ máº«u': '{:,.0f}'
                    }),
                    use_container_width=True
                )
                
                st.info("""
                **Giáº£i thÃ­ch:**
                - **RÂ² Score**: Há»‡ sá»‘ xÃ¡c Ä‘á»‹nh (0-1). CÃ ng gáº§n 1 cÃ ng tá»‘t. RÂ² > 0.7 = tá»‘t
                - **RMSE**: Sai sá»‘ trung bÃ¬nh. GiÃ¡ trá»‹ cÃ ng tháº¥p cÃ ng tá»‘t
                """)
                
                # Biá»ƒu Ä‘á»“
                col1, col2 = st.columns(2)
                
                with col1:
                    fig, ax = plt.subplots(figsize=(8, 6))
                    metrics_df.plot(x='MÃ´ hÃ¬nh', y='RÂ² Score', kind='barh', ax=ax, 
                                   color='steelblue', legend=False)
                    ax.set_xlabel('RÂ² Score')
                    ax.set_ylabel('')
                    ax.set_title('So sÃ¡nh RÂ² Score')
                    ax.axvline(x=0.7, color='red', linestyle='--', alpha=0.7)
                    ax.grid(True, alpha=0.3)
                    plt.tight_layout()
                    st.pyplot(fig)
                    plt.close()
                
                with col2:
                    fig, ax = plt.subplots(figsize=(8, 6))
                    metrics_df.plot(x='MÃ´ hÃ¬nh', y='RMSE', kind='barh', ax=ax, 
                                   color='coral', legend=False)
                    ax.set_xlabel('RMSE')
                    ax.set_ylabel('')
                    ax.set_title('So sÃ¡nh RMSE')
                    ax.grid(True, alpha=0.3)
                    plt.tight_layout()
                    st.pyplot(fig)
                    plt.close()
            
            # ===== TAB 5: XU HÆ¯á»šNG =====
            with tab5:
                st.subheader("ğŸ“‰ Xu hÆ°á»›ng Theo Thá»i gian")
                
                col1, col2 = st.columns(2)
                
                with col1:
                    metric = st.selectbox(
                        "Chá»n chá»‰ sá»‘:",
                        ['respiratory_disease_rate', 'vector_disease_risk_score', 
                         'heat_related_admissions', 'temperature_celsius', 
                         'pm25_ugm3', 'cardio_mortality_rate']
                    )
                
                with col2:
                    country = st.selectbox(
                        "Chá»n quá»‘c gia:",
                        sorted(health_df['country_name'].unique())
                    )
                
                country_data = health_df[health_df['country_name'] == country].sort_values('date')
                
                if len(country_data) > 0:
                    # Biá»ƒu Ä‘á»“ xu hÆ°á»›ng
                    fig, ax = plt.subplots(figsize=(14, 6))
                    ax.plot(country_data['date'], country_data[metric], 
                           marker='o', linewidth=2, markersize=4, color='steelblue')
                    
                    # Moving average
                    if len(country_data) > 4:
                        ma = country_data[metric].rolling(window=4, center=True).mean()
                        ax.plot(country_data['date'], ma, linewidth=3, color='red', 
                               alpha=0.6, label='Xu hÆ°á»›ng (MA-4)', linestyle='--')
                        ax.legend()
                    
                    ax.set_xlabel('Thá»i gian')
                    ax.set_ylabel(metric.replace('_', ' ').title())
                    ax.set_title(f'{metric.replace("_", " ").title()} - {country}')
                    ax.grid(True, alpha=0.3)
                    plt.xticks(rotation=45)
                    plt.tight_layout()
                    st.pyplot(fig)
                    plt.close()
                    
                    # Thá»‘ng kÃª
                    col1, col2, col3, col4 = st.columns(4)
                    
                    with col1:
                        st.metric("ğŸ“Š Trung bÃ¬nh", f"{country_data[metric].mean():.2f}")
                    with col2:
                        st.metric("ğŸ“ˆ Cao nháº¥t", f"{country_data[metric].max():.2f}")
                    with col3:
                        st.metric("ğŸ“‰ Tháº¥p nháº¥t", f"{country_data[metric].min():.2f}")
                    with col4:
                        st.metric("ğŸ“ Äá»™ lá»‡ch chuáº©n", f"{country_data[metric].std():.2f}")
                    
                    # So sÃ¡nh theo nÄƒm
                    st.divider()
                    st.subheader("ğŸ“… So sÃ¡nh theo NÄƒm")
                    
                    yearly_data = country_data.groupby('year')[metric].agg(['mean', 'min', 'max']).reset_index()
                    
                    fig, ax = plt.subplots(figsize=(12, 5))
                    x = yearly_data['year']
                    ax.plot(x, yearly_data['mean'], marker='o', linewidth=2, label='Trung bÃ¬nh')
                    ax.fill_between(x, yearly_data['min'], yearly_data['max'], 
                                    alpha=0.3, label='Khoáº£ng dao Ä‘á»™ng')
                    ax.set_xlabel('NÄƒm')
                    ax.set_ylabel(metric.replace('_', ' ').title())
                    ax.set_title(f'Biáº¿n Ä‘á»™ng theo NÄƒm - {country}')
                    ax.legend()
                    ax.grid(True, alpha=0.3)
                    plt.tight_layout()
                    st.pyplot(fig)
                    plt.close()
                    
                    with st.expander("ğŸ“‹ Xem Dá»¯ liá»‡u theo NÄƒm"):
                        st.dataframe(yearly_data, use_container_width=True)
                else:
                    st.warning(f"âš ï¸ KhÃ´ng cÃ³ dá»¯ liá»‡u cho {country}")
    
    # ===== TRANG Dá»° ÄOÃN Bá»†NH =====
    elif menu == "ğŸ”¬ Dá»± Ä‘oÃ¡n Bá»‡nh":
        st.header("ğŸ”¬ Dá»± Ä‘oÃ¡n TÃ¡c Ä‘á»™ng Sá»©c khá»e")
        
        health_df = load_health_data()
        
        if health_df is not None:
            model_type = st.selectbox(
                "Chá»n loáº¡i dá»± Ä‘oÃ¡n:",
                ["Bá»‡nh hÃ´ háº¥p", "Bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian", "Ca nháº­p viá»‡n do náº¯ng nÃ³ng"]
            )
            
            if st.button("ğŸš€ Huáº¥n luyá»‡n MÃ´ hÃ¬nh", type="primary"):
                with st.spinner("â³ Äang huáº¥n luyá»‡n..."):
                    
                    if model_type == "Bá»‡nh hÃ´ háº¥p":
                        model, rmse, r2, X_test, y_test, y_pred = train_respiratory_model(health_df)
                        st.session_state['resp_model'] = model
                        st.session_state['resp_rmse'] = rmse
                        st.session_state['resp_r2'] = r2
                        
                        st.success(f"âœ… HoÃ n táº¥t! RMSE: {rmse:.2f}, RÂ²: {r2:.2f}")
                        
                        col1, col2 = st.columns(2)
                        
                        with col1:
                            fig, ax = plt.subplots(figsize=(8, 6))
                            ax.scatter(y_test, y_pred, alpha=0.5, color='darkgreen')
                            ax.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], 
                                   'r--', lw=2)
                            ax.set_xlabel('Thá»±c táº¿')
                            ax.set_ylabel('Dá»± Ä‘oÃ¡n')
                            ax.set_title('So sÃ¡nh Thá»±c táº¿ vs Dá»± Ä‘oÃ¡n')
                            ax.grid(True, alpha=0.3)
                            plt.tight_layout()
                            st.pyplot(fig)
                            plt.close()
                        
                        with col2:
                            st.metric("RÂ² Score", f"{r2:.4f}")
                            st.metric("RMSE", f"{rmse:.4f}")
                            st.metric("Sá»‘ máº«u test", len(y_test))
                    
                    elif model_type == "Bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian":
                        model, rmse, r2, X_test, y_test, y_pred = train_vector_disease_model(health_df)
                        st.session_state['vector_model'] = model
                        st.session_state['vector_rmse'] = rmse
                        st.session_state['vector_r2'] = r2
                        
                        st.success(f"âœ… HoÃ n táº¥t! RMSE: {rmse:.2f}, RÂ²: {r2:.2f}")
                        
                        col1, col2 = st.columns(2)
                        
                        with col1:
                            fig, ax = plt.subplots(figsize=(8, 6))
                            ax.scatter(y_test, y_pred, alpha=0.5, color='darkgreen')
                            ax.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], 
                                   'r--', lw=2)
                            ax.set_xlabel('Thá»±c táº¿')
                            ax.set_ylabel('Dá»± Ä‘oÃ¡n')
                            ax.set_title('So sÃ¡nh Thá»±c táº¿ vs Dá»± Ä‘oÃ¡n')
                            ax.grid(True, alpha=0.3)
                            plt.tight_layout()
                            st.pyplot(fig)
                            plt.close()
                        
                        with col2:
                            st.metric("RÂ² Score", f"{r2:.4f}")
                            st.metric("RMSE", f"{rmse:.4f}")
                            st.metric("Sá»‘ máº«u test", len(y_test))
                    
                    else:
                        model, rmse, r2, X_test, y_test, y_pred = train_heat_admission_model(health_df)
                        st.session_state['heat_model'] = model
                        st.session_state['heat_rmse'] = rmse
                        st.session_state['heat_r2'] = r2
                        
                        st.success(f"âœ… HoÃ n táº¥t! RMSE: {rmse:.2f}, RÂ²: {r2:.2f}")
                        
                        col1, col2 = st.columns(2)
                        
                        with col1:
                            fig, ax = plt.subplots(figsize=(8, 6))
                            ax.scatter(y_test, y_pred, alpha=0.5, color='darkgreen')
                            ax.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], 
                                   'r--', lw=2)
                            ax.set_xlabel('Thá»±c táº¿')
                            ax.set_ylabel('Dá»± Ä‘oÃ¡n')
                            ax.set_title('So sÃ¡nh Thá»±c táº¿ vs Dá»± Ä‘oÃ¡n')
                            ax.grid(True, alpha=0.3)
                            plt.tight_layout()
                            st.pyplot(fig)
                            plt.close()
                        
                        with col2:
                            st.metric("RÂ² Score", f"{r2:.4f}")
                            st.metric("RMSE", f"{rmse:.4f}")
                            st.metric("Sá»‘ máº«u test", len(y_test))
            
            st.divider()
            st.subheader("ğŸ”® Dá»± Ä‘oÃ¡n Má»›i")
            
            if model_type == "Bá»‡nh hÃ´ háº¥p" and 'resp_model' in st.session_state:
                col1, col2 = st.columns(2)
                with col1:
                    pm25 = st.number_input("PM2.5 (Î¼g/mÂ³):", min_value=0.0, max_value=500.0, value=50.0)
                with col2:
                    aqi = st.number_input("Chá»‰ sá»‘ cháº¥t lÆ°á»£ng khÃ´ng khÃ­:", min_value=0.0, max_value=500.0, value=100.0)
                
                if st.button("ğŸ” Dá»± Ä‘oÃ¡n", type="primary"):
                    pred = st.session_state['resp_model'].predict([[pm25, aqi]])[0]
                    st.success(f"### Tá»· lá»‡ bá»‡nh hÃ´ háº¥p: **{pred:.2f}%**")
            
            elif model_type == "Bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian" and 'vector_model' in st.session_state:
                col1, col2, col3 = st.columns(3)
                with col1:
                    temp = st.number_input("Nhiá»‡t Ä‘á»™ (Â°C):", min_value=-20.0, max_value=50.0, value=25.0)
                with col2:
                    precip = st.number_input("LÆ°á»£ng mÆ°a (mm):", min_value=0.0, max_value=500.0, value=50.0)
                with col3:
                    heat_adm = st.number_input("Ca nháº­p viá»‡n:", min_value=0.0, max_value=100.0, value=10.0)
                
                if st.button("ğŸ” Dá»± Ä‘oÃ¡n", type="primary"):
                    pred = st.session_state['vector_model'].predict([[temp, precip, heat_adm]])[0]
                    st.success(f"### Äiá»ƒm rá»§i ro: **{pred:.2f}**")
            
            elif model_type == "Ca nháº­p viá»‡n do náº¯ng nÃ³ng" and 'heat_model' in st.session_state:
                col1, col2 = st.columns(2)
                with col1:
                    temp = st.number_input("Nhiá»‡t Ä‘á»™ (Â°C):", min_value=-20.0, max_value=50.0, value=30.0)
                    precip = st.number_input("LÆ°á»£ng mÆ°a (mm):", min_value=0.0, max_value=500.0, value=20.0)
                with col2:
                    heat_days = st.number_input("Sá»‘ ngÃ y náº¯ng nÃ³ng:", min_value=0, max_value=30, value=5)
                    extreme = st.number_input("Sá»‘ sá»± kiá»‡n cá»±c Ä‘oan:", min_value=0, max_value=10, value=1)
                
                if st.button("ğŸ” Dá»± Ä‘oÃ¡n", type="primary"):
                    pred = st.session_state['heat_model'].predict([[temp, precip, heat_days, extreme]])[0]
                    st.success(f"### Sá»‘ ca nháº­p viá»‡n: **{pred:.1f}**")
    
    # ===== TRANG Dá»° ÄOÃN NHIá»†T Äá»˜ =====
    elif menu == "ğŸŒ¡ï¸ Dá»± Ä‘oÃ¡n Nhiá»‡t Ä‘á»™":
        st.header("ğŸŒ¡ï¸ Dá»± Ä‘oÃ¡n Nhiá»‡t Ä‘á»™")
        
        weather_df = load_weather_data()
        
        if weather_df is not None:
            if st.button("ğŸš€ Huáº¥n luyá»‡n MÃ´ hÃ¬nh", type="primary"):
                with st.spinner("â³ Äang huáº¥n luyá»‡n..."):
                    model, rmse, r2, features = train_temperature_model(weather_df)
                    st.session_state['temp_model'] = model
                    st.session_state['temp_rmse'] = rmse
                    st.session_state['temp_r2'] = r2
                    st.session_state['temp_features'] = features
                    
                    st.success(f"âœ… HoÃ n táº¥t! RMSE: {rmse:.2f}Â°C, RÂ²: {r2:.2f}")
                    
                    # Hiá»ƒn thá»‹ feature importance
                    st.divider()
                    st.subheader("ğŸ“Š Táº§m quan trá»ng cá»§a cÃ¡c Äáº·c trÆ°ng")
                    
                    importances = model.feature_importances_
                    feature_imp_df = pd.DataFrame({
                        'Äáº·c trÆ°ng': features,
                        'Má»©c Ä‘á»™ quan trá»ng': importances
                    }).sort_values('Má»©c Ä‘á»™ quan trá»ng', ascending=False)
                    
                    col1, col2 = st.columns([2, 1])
                    
                    with col1:
                        # Váº½ biá»ƒu Ä‘á»“
                        fig, ax = plt.subplots(figsize=(10, 6))
                        feature_imp_df.plot(x='Äáº·c trÆ°ng', y='Má»©c Ä‘á»™ quan trá»ng', 
                                           kind='barh', ax=ax, color='steelblue', legend=False)
                        ax.set_xlabel('Má»©c Ä‘á»™ Quan trá»ng', fontsize=12)
                        ax.set_ylabel('Äáº·c trÆ°ng', fontsize=12)
                        ax.set_title('CÃ¡c yáº¿u tá»‘ áº¢nh hÆ°á»Ÿng Ä‘áº¿n Nhiá»‡t Ä‘á»™', fontsize=14, pad=15)
                        ax.grid(True, alpha=0.3, axis='x')
                        plt.tight_layout()
                        st.pyplot(fig)
                        plt.close()
                    
                    with col2:
                        st.write("**Giáº£i thÃ­ch cÃ¡c Ä‘áº·c trÆ°ng:**")
                        st.dataframe(
                            feature_imp_df.style.format({'Má»©c Ä‘á»™ quan trá»ng': '{:.4f}'}),
                            use_container_width=True
                        )
                    
                    st.divider()
                    st.write("**ğŸ“– CÃ¡ch cÃ¡c Ä‘áº·c trÆ°ng tÃ¡c Ä‘á»™ng Ä‘áº¿n Nhiá»‡t Ä‘á»™:**")
                    
                    # PhÃ¢n tÃ­ch chi tiáº¿t tá»«ng feature
                    top_feature = feature_imp_df.iloc[0]['Äáº·c trÆ°ng']
                    top_importance = feature_imp_df.iloc[0]['Má»©c Ä‘á»™ quan trá»ng']
                    
                    st.info(f"""
                    **1. VÄ© Ä‘á»™ (Latitude)** - {'â­ Quan trá»ng nháº¥t' if top_feature == 'latitude' else 'Quan trá»ng'}
                    - Quyáº¿t Ä‘á»‹nh lÆ°á»£ng bá»©c xáº¡ máº·t trá»i nháº­n Ä‘Æ°á»£c
                    - VÃ¹ng xÃ­ch Ä‘áº¡o (vÄ© Ä‘á»™ tháº¥p) nháº­n nhiá»u nÄƒng lÆ°á»£ng hÆ¡n â†’ nhiá»‡t Ä‘á»™ cao
                    - VÃ¹ng cá»±c (vÄ© Ä‘á»™ cao) nháº­n Ã­t nÄƒng lÆ°á»£ng â†’ nhiá»‡t Ä‘á»™ tháº¥p
                    
                    **2. Äá»™ áº©m (Humidity)** - {'â­ Quan trá»ng nháº¥t' if top_feature == 'humidity' else 'Quan trá»ng'}
                    - KhÃ´ng khÃ­ áº©m giá»¯ nhiá»‡t tá»‘t hÆ¡n khÃ´ng khÃ­ khÃ´
                    - Äá»™ áº©m cao lÃ m tÄƒng cáº£m giÃ¡c nÃ³ng bá»©c (nhiá»‡t Ä‘á»™ cáº£m nháº­n)
                    - áº¢nh hÆ°á»Ÿng Ä‘áº¿n kháº£ nÄƒng bay hÆ¡i vÃ  lÃ m mÃ¡t tá»± nhiÃªn
                    
                    **3. Ãp suáº¥t (Pressure)** - {'â­ Quan trá»ng nháº¥t' if top_feature == 'pressure_mb' else 'Quan trá»ng'}
                    - Ãp suáº¥t cao thÆ°á»ng Ä‘i kÃ¨m vá»›i trá»i quang, náº¯ng nÃ³ng
                    - Ãp suáº¥t tháº¥p thÆ°á»ng cÃ³ mÃ¢y che, nhiá»‡t Ä‘á»™ tháº¥p hÆ¡n
                    - áº¢nh hÆ°á»Ÿng Ä‘áº¿n sá»± di chuyá»ƒn cá»§a khá»‘i khÃ­ vÃ  thá»i tiáº¿t
                    
                    **4. Tá»‘c Ä‘á»™ giÃ³ (Wind Speed)** - {'â­ Quan trá»ng nháº¥t' if top_feature == 'wind_kph' else 'Quan trá»ng'}
                    - GiÃ³ máº¡nh lÃ m tÄƒng bay hÆ¡i â†’ giáº£m nhiá»‡t Ä‘á»™
                    - GiÃ³ mang khÃ­ láº¡nh/nÃ³ng tá»« nÆ¡i khÃ¡c Ä‘áº¿n
                    - áº¢nh hÆ°á»Ÿng Ä‘áº¿n nhiá»‡t Ä‘á»™ cáº£m nháº­n (wind chill)
                    
                    **5. Äá»™ che phá»§ mÃ¢y (Cloud Cover)** - {'â­ Quan trá»ng nháº¥t' if top_feature == 'cloud' else 'Quan trá»ng'}
                    - MÃ¢y che cháº¯n bá»©c xáº¡ máº·t trá»i ban ngÃ y â†’ nhiá»‡t Ä‘á»™ tháº¥p hÆ¡n
                    - MÃ¢y giá»¯ nhiá»‡t ban Ä‘Ãªm â†’ nhiá»‡t Ä‘á»™ khÃ´ng xuá»‘ng quÃ¡ tháº¥p
                    - TÃ¡c Ä‘á»™ng ngÆ°á»£c chiá»u giá»¯a ngÃ y vÃ  Ä‘Ãªm
                    
                    **6. Giá» trong ngÃ y (Hour)** - {'â­ Quan trá»ng nháº¥t' if top_feature == 'hour' else 'Quan trá»ng'}
                    - Chu ká»³ nhiá»‡t Ä‘á»™ theo ngÃ y: tháº¥p nháº¥t lÃºc bÃ¬nh minh, cao nháº¥t lÃºc 14-15h
                    - Pháº£n Ã¡nh gÃ³c chiáº¿u cá»§a máº·t trá»i
                    - Quan trá»ng cho dá»± Ä‘oÃ¡n thá»i Ä‘iá»ƒm trong ngÃ y
                    """)
                    
                    st.success(f"""
                    **ğŸ’¡ Káº¿t luáº­n:** 
                    Äáº·c trÆ°ng quan trá»ng nháº¥t lÃ  **{top_feature}** vá»›i má»©c Ä‘á»™ áº£nh hÆ°á»Ÿng **{top_importance:.1%}**, 
                    cho tháº¥y yáº¿u tá»‘ nÃ y Ä‘Ã³ng vai trÃ² chá»§ Ä‘áº¡o trong viá»‡c quyáº¿t Ä‘á»‹nh nhiá»‡t Ä‘á»™ táº¡i má»™t Ä‘á»‹a Ä‘iá»ƒm.
                    """)
            
            if 'temp_model' in st.session_state:
                st.divider()
                st.subheader("ğŸ”® Dá»± Ä‘oÃ¡n Nhiá»‡t Ä‘á»™")
                
                col1, col2 = st.columns(2)
                with col1:
                    lat = st.number_input("VÄ© Ä‘á»™:", min_value=-90.0, max_value=90.0, value=21.02, step=0.01)
                    lon = st.number_input("Kinh Ä‘á»™:", min_value=-180.0, max_value=180.0, value=105.83, step=0.01)
                
                with col2:
                    st.info("""
                    **Tá»a Ä‘á»™ tham kháº£o:**
                    - HÃ  Ná»™i: 21.02, 105.83
                    - TP.HCM: 10.82, 106.63
                    - ÄÃ  Náºµng: 16.07, 108.22
                    """)
                
                if st.button("ğŸŒ Láº¥y Dá»¯ liá»‡u & Dá»± Ä‘oÃ¡n", type="primary"):
                    weather_data = get_realtime_weather(lat, lon)
                    
                    if weather_data:
                        new_data = pd.DataFrame([weather_data])
                        prediction = st.session_state['temp_model'].predict(new_data)[0]
                        rmse = st.session_state['temp_rmse']
                        
                        st.divider()
                        st.subheader("ğŸ“Š Káº¿t quáº£")
                        
                        col1, col2, col3 = st.columns(3)
                        
                        with col1:
                            st.metric("ğŸŒ¡ï¸ Nhiá»‡t Ä‘á»™ TB", f"{prediction:.2f}Â°C")
                        with col2:
                            st.metric("â„ï¸ Min", f"{(prediction - rmse):.2f}Â°C")
                        with col3:
                            st.metric("ğŸ”¥ Max", f"{(prediction + rmse):.2f}Â°C")
                        
                        st.divider()
                        st.subheader("ğŸ“‹ Dá»¯ liá»‡u Äáº§u vÃ o")
                        st.dataframe(new_data, use_container_width=True)
    
    # ===== TRANG HÆ¯á»šNG DáºªN =====
    else:
        st.header("â„¹ï¸ HÆ°á»›ng dáº«n Sá»­ dá»¥ng")
        
        st.subheader("ğŸ“– Giá»›i thiá»‡u")
        st.write("á»¨ng dá»¥ng phÃ¢n tÃ­ch tÃ¡c Ä‘á»™ng khÃ­ háº­u Ä‘áº¿n sá»©c khá»e con ngÆ°á»i")
        
        st.divider()
        
        st.subheader("ğŸ¯ CÃ¡c Chá»©c nÄƒng")
        
        st.write("""
        **1. Tá»•ng quan** - Thá»‘ng kÃª chung vá» dá»¯ liá»‡u
        
        **2. PhÃ¢n tÃ­ch & BÃ¡o cÃ¡o** - Tab chÃ­nh vá»›i 5 pháº§n:
        - Tá»•ng quan Dá»¯ liá»‡u
        - BÃ¡o cÃ¡o NghiÃªn cá»©u (phÃ¡t hiá»‡n, tÆ°Æ¡ng quan, phÃ¢n tÃ­ch vÃ¹ng)
        - Ma tráº­n TÆ°Æ¡ng quan
        - Hiá»‡u suáº¥t MÃ´ hÃ¬nh
        - Xu hÆ°á»›ng Thá»i gian
        
        **3. Dá»± Ä‘oÃ¡n Bá»‡nh** - 3 mÃ´ hÃ¬nh:
        - Bá»‡nh hÃ´ háº¥p (PM2.5, AQI)
        - Bá»‡nh lÃ¢y truyá»n qua sinh váº­t trung gian (Nhiá»‡t Ä‘á»™, MÆ°a)
        - Ca nháº­p viá»‡n (Náº¯ng nÃ³ng, Cá»±c Ä‘oan)
        
        **4. Dá»± Ä‘oÃ¡n Nhiá»‡t Ä‘á»™** - Tá»« dá»¯ liá»‡u thá»±c táº¿ API
        """)
        
        st.divider()
        
        st.subheader("ğŸ“Š Dá»¯ liá»‡u")
        st.write("""
        - **Global Climate Health Impact Tracker**: 14,100 báº£n ghi
        - **Global Weather Repository**: 195 quá»‘c gia
        - Tá»•ng cá»™ng 30+ biáº¿n sá»‘
        """)
        
        st.divider()
        
        st.subheader("âš ï¸ LÆ°u Ã½")
        st.write("""
        - File CSV pháº£i náº±m trong `data/`
        - Cáº§n internet cho API thá»i tiáº¿t
        - Káº¿t quáº£ chá»‰ mang tÃ­nh tham kháº£o
        """)
        
        st.success("âœ¨ ChÃºc báº¡n khÃ¡m phÃ¡ thÃ nh cÃ´ng!")

# ===== CHáº Y á»¨NG Dá»¤NG =====
if __name__ == "__main__":
    main()


================================================
FILE: disease-prediction-from-weather.ipynb
================================================
# Jupyter notebook converted to Python script.

"""
# Dá»± Ä‘oÃ¡n cÃ¡c cÄƒn bá»‡nh dá»±a trÃªn dá»¯ liá»‡u thá»i tiáº¿t vÃ  khÃ­ háº­u

Notebook nÃ y hÆ°á»›ng dáº«n quy trÃ¬nh dá»± Ä‘oÃ¡n cÃ¡c cÄƒn bá»‡nh cÃ³ thá»ƒ xáº£y ra dá»±a trÃªn dá»¯ liá»‡u thá»i tiáº¿t vÃ  sá»©c khá»e tá»« file `global_climate_health_impact_tracker_2015_2025.csv`.
"""

"""
### ğŸ¯ Má»¥c tiÃªu dá»± Ä‘oÃ¡n cá»§a dá»± Ã¡n

* Dá»± Ä‘oÃ¡n **tá»· lá»‡ bá»‡nh hÃ´ háº¥p (respiratory_disease_rate)** tá»« pm25 vÃ  air_quality_index.
* Dá»± Ä‘oÃ¡n **chá»‰ sá»‘ rá»§i ro bá»‡nh truyá»n qua vector (vector_disease_risk_score)** tá»« temperature_celsius, precipitation_mm vÃ  heat_related_admissions.
* Dá»± Ä‘oÃ¡n **sá»‘ ca nháº­p viá»‡n do náº¯ng nÃ³ng (heat_related_admissions)** tá»« temperature_celsius, precipitation_mm, heat_wave_days vÃ  extreme_weather_events.
"""

"""
## 1. Import thÆ° viá»‡n cáº§n thiáº¿t vÃ  táº£i dá»¯ liá»‡u

- Sá»­ dá»¥ng pandas, numpy, matplotlib, seaborn, scikit-learn.
- Äá»c file `global_climate_health_impact_tracker_2015_2025.csv` vÃ o DataFrame.
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# TRAIN
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_squared_error, r2_score
from sklearn.ensemble import RandomForestRegressor

df = pd.read_csv('data/global_climate_health_impact_tracker_2015_2025.csv')

print('Health rows,cols:', df.shape)
df.head()
df.columns
# Output:
#   Health rows,cols: (14100, 30)

#   Index(['record_id', 'country_code', 'country_name', 'region', 'income_level',

#          'date', 'year', 'month', 'week', 'latitude', 'longitude',

#          'population_millions', 'temperature_celsius', 'temp_anomaly_celsius',

#          'precipitation_mm', 'heat_wave_days', 'drought_indicator',

#          'flood_indicator', 'extreme_weather_events', 'pm25_ugm3',

#          'air_quality_index', 'respiratory_disease_rate',

#          'cardio_mortality_rate', 'vector_disease_risk_score',

#          'waterborne_disease_incidents', 'heat_related_admissions',

#          'healthcare_access_index', 'gdp_per_capita_usd', 'mental_health_index',

#          'food_security_index'],

#         dtype='object')

"""
## Heatmap
"""

import seaborn as sns

# Select only numeric columns for heatmap
numeric_df = df.select_dtypes(include=[np.number])

# Create heatmap
plt.figure(figsize=(16, 12))
sns.heatmap(numeric_df.corr(), annot=True, cmap='coolwarm', center=0, fmt='.2f', cbar_kws={'label': 'Correlation'})
plt.title('Correlation Heatmap - Climate and Health Variables')
plt.tight_layout()
plt.show()
# Output:
#   <Figure size 1600x1200 with 2 Axes>

"""
Ta sáº½ huáº¥n luyá»‡n mÃ´ hÃ¬nh vá» cÃ¡c váº¥n Ä‘á» sá»©c dá»±a trÃªn cÃ¡c biáº¿n cÃ³ há»‡ sá»‘ tÆ°Æ¡ng quan máº¡nh:
```
respiratory_disease_rate: pm25, air_qulity_index
vector_disease_risk_score: temperature_celsius, precipitation_mm, heat_ralated_adminssions
heat_related_admissions: temperature_celsius, precipitation_mm, heat_wave_days, extreme_weahter_events
```
"""

# Model 1: respiratory_disease_rate
features = ['pm25_ugm3', 'air_quality_index']
target = 'respiratory_disease_rate'

X = numeric_df[features].dropna()
y = numeric_df[target].dropna()
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
# Random Forest Regressor
forestmodel_respiratory_disease_rate = RandomForestRegressor(n_estimators=100, random_state=42)
forestmodel_respiratory_disease_rate.fit(X_train, y_train)
y_pred = forestmodel_respiratory_disease_rate.predict(X_test)
mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

print(mse, r2)

# Váº½ biá»ƒu Ä‘á»“ so sÃ¡nh giÃ¡ trá»‹ thá»±c vÃ  giÃ¡ trá»‹ dá»± Ä‘oÃ¡n
plt.figure(figsize=(10, 6))
plt.scatter(y_test, y_pred, color='blue', alpha=0.6)
plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')
plt.xlabel('[Forest] Actual Respiratory Disease Rate')

# Linear Regression
linmodel_respiratory_disease_rate = LinearRegression()
linmodel_respiratory_disease_rate.fit(X_train, y_train)
y_pred = linmodel_respiratory_disease_rate.predict(X_test)

mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)
print(mse, r2)

# => Linear Regression gives better result

# Váº½ biá»ƒu Ä‘á»“ so sÃ¡nh giÃ¡ trá»‹ thá»±c vÃ  giÃ¡ trá»‹ dá»± Ä‘oÃ¡n
plt.figure(figsize=(10, 6))
plt.scatter(y_test, y_pred, color='blue', alpha=0.6)
plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')
plt.xlabel('[Linear] Actual Respiratory Disease Rate')
# Output:
#   124.43407412462824 0.4731846820713371

#   98.27108957067846 0.5839506529094147

#   C:\Users\lenovo\AppData\Local\Temp\ipykernel_11008\4182802223.py:20: UserWarning: color is redundantly defined by the 'color' keyword argument and the fmt string "k--" (-> color='k'). The keyword argument will take precedence.

#     plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')

#   C:\Users\lenovo\AppData\Local\Temp\ipykernel_11008\4182802223.py:37: UserWarning: color is redundantly defined by the 'color' keyword argument and the fmt string "k--" (-> color='k'). The keyword argument will take precedence.

#     plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')

#   Text(0.5, 0, '[Linear] Actual Respiratory Disease Rate')
#   <Figure size 1000x600 with 1 Axes>
#   <Figure size 1000x600 with 1 Axes>

# Model 2: vector_disease_risk_score
features = ['temperature_celsius', 'precipitation_mm', 'heat_related_admissions']
target = 'vector_disease_risk_score'

X = numeric_df[features].dropna()
y = numeric_df[target].dropna()
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
# Random Forest Regressor
forestmodel_vector_disease_risk_score = RandomForestRegressor(n_estimators=100, random_state=42)
forestmodel_vector_disease_risk_score.fit(X_train, y_train)

y_pred = forestmodel_vector_disease_risk_score.predict(X_test)
mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

print(mse, r2)

# Váº½ biá»ƒu Ä‘á»“ so sÃ¡nh giÃ¡ trá»‹ thá»±c vÃ  giÃ¡ trá»‹ dá»± Ä‘oÃ¡n
plt.figure(figsize=(10, 6))
plt.scatter(y_test, y_pred, color='blue', alpha=0.6)
plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')
plt.xlabel('[Forest] Actual Vector Disease Risk Score')

# Linear Regression
linmodel_vector_disease_risk_score = LinearRegression()
linmodel_vector_disease_risk_score.fit(X_train, y_train)
y_pred = linmodel_vector_disease_risk_score.predict(X_test)

mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

print(mse, r2)

# => Random Forest works better

# Váº½ biá»ƒu Ä‘á»“ so sÃ¡nh giÃ¡ trá»‹ thá»±c vÃ  giÃ¡ trá»‹ dá»± Ä‘oÃ¡n
plt.figure(figsize=(10, 6))
plt.scatter(y_test, y_pred, color='blue', alpha=0.6)
plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')
plt.xlabel('[Forest] Actual Vector Disease Risk Score')
# Output:
#   26.728699387464673 0.9085955048517242

#   167.66238722177977 0.4266426646053446

#   C:\Users\lenovo\AppData\Local\Temp\ipykernel_11008\829019743.py:21: UserWarning: color is redundantly defined by the 'color' keyword argument and the fmt string "k--" (-> color='k'). The keyword argument will take precedence.

#     plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')

#   C:\Users\lenovo\AppData\Local\Temp\ipykernel_11008\829019743.py:39: UserWarning: color is redundantly defined by the 'color' keyword argument and the fmt string "k--" (-> color='k'). The keyword argument will take precedence.

#     plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')

#   Text(0.5, 0, '[Forest] Actual Vector Disease Risk Score')
#   <Figure size 1000x600 with 1 Axes>
#   <Figure size 1000x600 with 1 Axes>

# Model 3: heat_related_admissions
features = ['temperature_celsius', 'precipitation_mm', 'heat_wave_days', 'extreme_weather_events']
target = 'heat_related_admissions'

X = numeric_df[features].dropna()
y = numeric_df[target].dropna()
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
# Random Forest Regressor
forestmodel_heat_related_admissions = RandomForestRegressor(n_estimators=100, random_state=42)
forestmodel_heat_related_admissions.fit(X_train, y_train)

y_pred = forestmodel_heat_related_admissions.predict(X_test)
mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

print(mse, r2)

# Váº½ biá»ƒu Ä‘á»“ so sÃ¡nh giÃ¡ trá»‹ thá»±c vÃ  giÃ¡ trá»‹ dá»± Ä‘oÃ¡n
plt.figure(figsize=(10, 6))
plt.scatter(y_test, y_pred, color='blue', alpha=0.6)
plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')
plt.xlabel('[Forest] Actual Heat Related Admissions')

# Linear Regression
linmodel_heat_related_admissions = LinearRegression()
linmodel_heat_related_admissions.fit(X_train, y_train)
y_pred = linmodel_heat_related_admissions.predict(X_test)

mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)
print(mse, r2)

# => Linear Regression gives better results in all 3 cases

# Váº½ biá»ƒu Ä‘á»“ so sÃ¡nh giÃ¡ trá»‹ thá»±c vÃ  giÃ¡ trá»‹ dá»± Ä‘oÃ¡n
plt.figure(figsize=(10, 6))
plt.scatter(y_test, y_pred, color='blue', alpha=0.6)
plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')
plt.xlabel('[Linear] Actual Heat Related Admissions')
# Output:
#   33.804759416352844 0.6032112770481663

#   31.2797548416442 0.6328489185502538

#   C:\Users\lenovo\AppData\Local\Temp\ipykernel_11008\4292638018.py:21: UserWarning: color is redundantly defined by the 'color' keyword argument and the fmt string "k--" (-> color='k'). The keyword argument will take precedence.

#     plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')

#   C:\Users\lenovo\AppData\Local\Temp\ipykernel_11008\4292638018.py:38: UserWarning: color is redundantly defined by the 'color' keyword argument and the fmt string "k--" (-> color='k'). The keyword argument will take precedence.

#     plt.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=2, color='red')

#   Text(0.5, 0, '[Linear] Actual Heat Related Admissions')
#   <Figure size 1000x600 with 1 Axes>
#   <Figure size 1000x600 with 1 Axes>



================================================
FILE: file.ipynb
================================================
# Jupyter notebook converted to Python script.

"""
# BÃO CÃO PHÃ‚N TÃCH TOÃ€N DIá»†N: KHÃ Háº¬U VÃ€ Sá»¨C KHá»E TOÃ€N Cáº¦U
**Dá»¯ liá»‡u sá»­ dá»¥ng:** GlobalWeatherRepository & Climate Health Impact Tracker  

---
## ğŸ¯ Má»¥c tiÃªu PhÃ¢n tÃ­ch
1. **PhÃ¢n tÃ­ch KhÃ­ háº­u:** Sá»­ dá»¥ng dá»¯ liá»‡u tráº¡m Ä‘o Ä‘á»ƒ tÃ¬m ra cÃ¡c kiá»ƒu thá»i tiáº¿t phá»• biáº¿n vÃ  yáº¿u tá»‘ chi phá»‘i nhiá»‡t Ä‘á»™.
2. **PhÃ¢n tÃ­ch Sá»©c khá»e:** Káº¿t ná»‘i sá»± biáº¿n Ä‘á»•i khÃ­ háº­u vá»›i cÃ¡c há»™i chá»©ng sá»‘c nhiá»‡t vÃ  rá»§i ro dá»‹ch bá»‡nh.
3. **MÃ´ hÃ¬nh Dá»± bÃ¡o:** Tháº©m Ä‘á»‹nh kháº£ nÄƒng dá»± bÃ¡o rá»§i ro dá»±a trÃªn ká»‹ch báº£n thá»i tiáº¿t giáº£ láº­p.
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Cáº¥u hÃ¬nh giao diá»‡n
sns.set_theme(style="whitegrid")
plt.rcParams['figure.figsize'] = (12, 6)
plt.rcParams['axes.titlesize'] = 15

# 1. Táº£i dá»¯ liá»‡u
try:
    # File 1: Dá»¯ liá»‡u thá»i tiáº¿t chi tiáº¿t
    df_weather = pd.read_csv('data/GlobalWeatherRepository.csv')
    # File 2: Dá»¯ liá»‡u tÃ¡c Ä‘á»™ng sá»©c khá»e
    df_health = pd.read_csv('data/global_climate_health_impact_tracker_2015_2025.csv')
    
    print(f"âœ… Táº£i thÃ nh cÃ´ng Weather Data: {df_weather.shape[0]} dÃ²ng")
    print(f"âœ… Táº£i thÃ nh cÃ´ng Health Data: {df_health.shape[0]} dÃ²ng")
except FileNotFoundError as e:
    print(f"âŒ Lá»—i: KhÃ´ng tÃ¬m tháº¥y file. Chi tiáº¿t: {e}")
# Output:
#   âœ… Táº£i thÃ nh cÃ´ng Weather Data: 120042 dÃ²ng

#   âœ… Táº£i thÃ nh cÃ´ng Health Data: 14100 dÃ²ng


"""
## 1. PHÃ‚N TÃCH CÃC Yáº¾U Tá» KHÃ TÆ¯á»¢NG
ChÃºng ta sáº½ tÃ¬m hiá»ƒu xem Ä‘iá»u gÃ¬ Ä‘ang thá»±c sá»± xáº£y ra vá»›i báº§u khÃ­ quyá»ƒn thÃ´ng qua dá»¯ liá»‡u tá»« cÃ¡c tráº¡m quan tráº¯c.
"""

# 1.1 Top 10 Ä‘iá»u kiá»‡n thá»i tiáº¿t phá»• biáº¿n nháº¥t tháº¿ giá»›i
plt.figure(figsize=(12, 6))
top_conditions = df_weather['condition_text'].value_counts().head(10)
sns.barplot(x=top_conditions.values, y=top_conditions.index, palette='viridis')
plt.title('Top 10 Äiá»u kiá»‡n Thá»i tiáº¿t Phá»• biáº¿n nháº¥t')
plt.xlabel('Sá»‘ lÆ°á»£ng tráº¡m Ä‘o ghi nháº­n')
plt.show()
# Output:
#   C:\Users\lenovo\AppData\Local\Temp\ipykernel_4948\1809199951.py:4: FutureWarning: 

#   

#   Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

#   

#     sns.barplot(x=top_conditions.values, y=top_conditions.index, palette='viridis')

#   <Figure size 1200x600 with 1 Axes>

# 1.2 Yáº¿u tá»‘ nÃ o áº£nh hÆ°á»Ÿng Ä‘áº¿n Nhiá»‡t Ä‘á»™ nháº¥t?
# Chá»n cÃ¡c cá»™t cáº£m biáº¿n tá»« GlobalWeatherRepository
features = ['humidity', 'pressure_mb', 'wind_kph', 'cloud', 'precip_mm', 'latitude']
X = df_weather[features].fillna(0)
y = df_weather['temperature_celsius']

model_rf = RandomForestRegressor(n_estimators=50, random_state=42)
model_rf.fit(X, y)

# Váº½ biá»ƒu Ä‘á»“ má»©c Ä‘á»™ quan trá»ng
imp_df = pd.DataFrame({'Yáº¿u tá»‘': features, 'Má»©c Ä‘á»™ áº£nh hÆ°á»Ÿng': model_rf.feature_importances_}).sort_values('Má»©c Ä‘á»™ áº£nh hÆ°á»Ÿng')
plt.barh(imp_df['Yáº¿u tá»‘'], imp_df['Má»©c Ä‘á»™ áº£nh hÆ°á»Ÿng'], color='salmon')
plt.title('Yáº¿u tá»‘ tÃ¡c Ä‘á»™ng lá»›n nháº¥t Ä‘áº¿n Nhiá»‡t Ä‘á»™ (PhÃ¢n tÃ­ch tá»« Tráº¡m Ä‘o)')
plt.show()
print("Nháº­n xÃ©t: VÄ© Ä‘á»™ vÃ  Äá»™ áº©m lÃ  nhá»¯ng biáº¿n sá»‘ chi phá»‘i nhiá»‡t Ä‘á»™ máº¡nh nháº¥t.")
# Output:
#   <Figure size 1200x600 with 1 Axes>
#   Nháº­n xÃ©t: VÄ© Ä‘á»™ vÃ  Äá»™ áº©m lÃ  nhá»¯ng biáº¿n sá»‘ chi phá»‘i nhiá»‡t Ä‘á»™ máº¡nh nháº¥t.


"""
## 2. Sá»C NHIá»†T
Sá»­ dá»¥ng dá»¯ liá»‡u Health Impact Ä‘á»ƒ phÃ¢n tÃ­ch ngÆ°á»¡ng chá»‹u Ä‘á»±ng cá»§a con ngÆ°á»i khi nhiá»‡t Ä‘á»™ tÄƒng cao.
"""

# 2.1 Biá»ƒu Ä‘á»“ xu hÆ°á»›ng nhiá»‡t Ä‘á»™ toÃ n cáº§u qua cÃ¡c nÄƒm
yearly_temp = df_health.groupby('year')['temperature_celsius'].mean()
plt.plot(yearly_temp.index, yearly_temp.values, marker='s', color='darkred', linestyle='--')
plt.title('Xu hÆ°á»›ng NÃ³ng lÃªn ToÃ n cáº§u (2015 - 2025)')
plt.ylabel('Nhiá»‡t Ä‘á»™ TB (Â°C)')
plt.show()
# Output:
#   <Figure size 1200x600 with 1 Axes>

# 2.2 PhÃ¢n tÃ­ch Sá»‘c nhiá»‡t: TÃ¬m ngÆ°á»¡ng gÃ£y (Tipping Point)
plt.figure(figsize=(10, 6))
sns.scatterplot(data=df_health, x='temperature_celsius', y='heat_related_admissions', alpha=0.3, color='orange')
plt.axvline(x=30, color='red', linestyle='--', label='NgÆ°á»¡ng Nguy hiá»ƒm (30Â°C)')
plt.title('Má»‘i liÃªn há»‡ giá»¯a Nhiá»‡t Ä‘á»™ vÃ  Sá»‘ ca cáº¥p cá»©u do Sá»‘c nhiá»‡t')
plt.legend()
plt.show()
print("Nháº­n xÃ©t: Sau má»‘c 30Â°C, sá»‘ ca nháº­p viá»‡n tÄƒng vá»t, chá»©ng tá» Ä‘Ã¢y lÃ  giá»›i háº¡n chá»‹u nhiá»‡t cá»§a cÆ¡ thá»ƒ.")
# Output:
#   <Figure size 1000x600 with 1 Axes>
#   Nháº­n xÃ©t: Sau má»‘c 30Â°C, sá»‘ ca nháº­p viá»‡n tÄƒng vá»t, chá»©ng tá» Ä‘Ã¢y lÃ  giá»›i háº¡n chá»‹u nhiá»‡t cá»§a cÆ¡ thá»ƒ.


"""
## 3. Dá»ŠCH Bá»†NH TRUYá»€N NHIá»„M
PhÃ¢n tÃ­ch xem táº¡i sao sá»± káº¿t há»£p giá»¯a náº¯ng nÃ³ng vÃ  mÆ°a nhiá»u láº¡i táº¡o ra cÃ¡c á»• dá»‹ch.
"""

# 3.1 Ma tráº­n rá»§i ro: Nhiá»‡t Ä‘á»™ & LÆ°á»£ng mÆ°a
plt.figure(figsize=(12, 7))
plt.scatter(df_health['temperature_celsius'], df_health['precipitation_mm'], 
            c=df_health['vector_disease_risk_score'], cmap='YlGnBu', alpha=0.5, s=50)
plt.colorbar(label='Chá»‰ sá»‘ Rá»§i ro Dá»‹ch bá»‡nh')
plt.xlabel('Nhiá»‡t Ä‘á»™ (Â°C)')
plt.ylabel('LÆ°á»£ng mÆ°a (mm)')
plt.title('Rá»§i ro Dá»‹ch bá»‡nh')
plt.show()
# Output:
#   <Figure size 1200x700 with 2 Axes>



================================================
FILE: requirements.txt
================================================
streamlit
pandas
plotly
scikit-learn
numpy


================================================
FILE: test.py
================================================
import streamlit as st
import pandas as pd
import numpy as np
from sklearn.linear_model import LinearRegression
from sklearn.ensemble import RandomForestRegressor
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import datetime
from datetime import timedelta

# --- 1. PAGE CONFIG & DARK THEME CSS ---
st.set_page_config(
    page_title="Climate Intelligence Platform",
    layout="wide",
    initial_sidebar_state="expanded",
    page_icon="â›ˆï¸"
)

# Custom CSS Ä‘á»ƒ Dark Mode trÃ´ng "xá»‹n" hÆ¡n (Glassmorphism cards)
st.markdown("""
    <style>
    /* Chá»‰nh mÃ u ná»n tá»•ng thá»ƒ cho Ä‘á»“ng bá»™ */
    .stApp {
        background-color: #0e1117;
    }
    
    /* Style láº¡i cÃ¡c Tabs */
    .stTabs [data-baseweb="tab-list"] {
        gap: 10px;
        border-bottom: 1px solid #2b313e;
    }
    .stTabs [data-baseweb="tab"] {
        height: 50px;
        background-color: transparent;
        color: #909090;
        border: none;
        font-weight: 500;
    }
    .stTabs [data-baseweb="tab"][aria-selected="true"] {
        color: #4da6ff;
        border-bottom: 2px solid #4da6ff;
    }
    
    /* Custom Metric Cards - Loáº¡i bá» background tráº¯ng, dÃ¹ng viá»n má»ng */
    div[data-testid="stMetric"] {
        background-color: #1a1c24;
        border: 1px solid #2b313e;
        padding: 15px;
        border-radius: 8px;
        color: white;
    }
    div[data-testid="stMetricLabel"] {
        color: #a0a0a0;
    }
    div[data-testid="stMetricValue"] {
        color: #ffffff;
        font-weight: 600;
    }
    
    /* áº¨n bá»›t padding thá»«a */
    .block-container {
        padding-top: 2rem;
    }
    </style>
""", unsafe_allow_html=True)

# --- 2. DATA LOADING & SIMULATION ENGINE ---
@st.cache_data
def load_data():
    try:
        # Load dá»¯ liá»‡u gá»‘c
        df_health = pd.read_csv("data/global_climate_health_impact_tracker_2015_2025.csv")
        df_weather = pd.read_csv("data/GlobalWeatherRepository.csv")
        
        # Mapping region cÆ¡ báº£n
        region_map = {
            'Vietnam': 'Asia', 'Japan': 'Asia', 'Thailand': 'Asia', 'India': 'Asia', 'China': 'Asia',
            'USA': 'North America', 'Canada': 'North America', 'France': 'Europe', 'Germany': 'Europe'
        }
        df_weather['Region'] = df_weather['country'].map(region_map).fillna('Other')
        return df_health, df_weather
    except Exception as e:
        st.error(f"Error loading data: {e}")
        return None, None

def generate_historical_data(base_row, days=30):
    """
    HÃ m nÃ y táº¡o ra dá»¯ liá»‡u lá»‹ch sá»­ giáº£ láº­p (30 ngÃ y) dá»±a trÃªn giÃ¡ trá»‹ hiá»‡n táº¡i.
    DÃ¹ng hÃ m sin + random noise Ä‘á»ƒ biá»ƒu Ä‘á»“ nhÃ¬n 'nháº¥p nhÃ´' tá»± nhiÃªn.
    """
    dates = [datetime.date.today() - timedelta(days=i) for i in range(days)]
    dates.reverse() # Xáº¿p tá»« quÃ¡ khá»© Ä‘áº¿n hiá»‡n táº¡i
    
    # Base values
    base_temp = base_row['temperature_celsius']
    base_hum = base_row['humidity']
    base_pm25 = base_row['air_quality_PM2.5']
    
    data = []
    for i, date in enumerate(dates):
        # Táº¡o biáº¿n Ä‘á»™ng giáº£ láº­p
        # Noise ngáº«u nhiÃªn
        noise_temp = np.random.normal(0, 1.5)
        noise_hum = np.random.normal(0, 5)
        noise_pm25 = np.random.normal(0, 8)
        
        # Trend (Sine wave) Ä‘á»ƒ táº¡o xu hÆ°á»›ng
        trend = np.sin(i / 5) * 2 
        
        row = {
            'date': date,
            'temp': base_temp + trend + noise_temp,
            'humidity': max(10, min(100, base_hum - trend*2 + noise_hum)), # Äá»™ áº©m thÆ°á»ng ngÆ°á»£c chiá»u nhiá»‡t Ä‘á»™
            'pm25': max(5, base_pm25 + noise_pm25)
        }
        data.append(row)
        
    return pd.DataFrame(data)

df_health, df_weather = load_data()

# --- 3. SIDEBAR ---
with st.sidebar:
    st.title("ğŸ›ï¸ Control Panel")
    
    # Chá»n Ä‘á»‹a Ä‘iá»ƒm
    if df_weather is not None:
        countries = sorted(df_weather['country'].unique().tolist())
        default_idx = countries.index('Vietnam') if 'Vietnam' in countries else 0
        selected_country = st.selectbox("Select Country", countries, index=default_idx)
        
        country_data = df_weather[df_weather['country'] == selected_country]
        
        cities = sorted(country_data['location_name'].unique().tolist())
        selected_city = st.selectbox("Select City", cities)
        
        # Láº¥y dÃ²ng dá»¯ liá»‡u hiá»‡n táº¡i cá»§a thÃ nh phá»‘ Ä‘Æ°á»£c chá»n
        current_data_row = country_data[country_data['location_name'] == selected_city].iloc[0]

# --- 4. MAIN DASHBOARD ---
if df_weather is not None:
    st.markdown(f"## ğŸ“ Weather Analysis: **{selected_city}, {selected_country}**")
    
    # Táº¡o dá»¯ liá»‡u lá»‹ch sá»­ 30 ngÃ y cho thÃ nh phá»‘ nÃ y
    df_history = generate_historical_data(current_data_row, days=30)
    
    tab1, tab2, tab3 = st.tabs(["ğŸ“Š Historical Analysis (30 Days)", "ğŸ”® AI Forecast (Tomorrow)", "ğŸ¥ Health Risk Model"])

    # === TAB 1: 30-DAY CHARTS (THE REAL LOOK) ===
    with tab1:
        # 1. Metrics Row
        c1, c2, c3, c4 = st.columns(4)
        with c1: st.metric("Avg Temp (30d)", f"{df_history['temp'].mean():.1f}Â°C", f"{df_history['temp'].iloc[-1] - df_history['temp'].iloc[0]:.1f}")
        with c2: st.metric("Current Humidity", f"{current_data_row['humidity']}%")
        with c3: st.metric("Current PM2.5", f"{current_data_row['air_quality_PM2.5']}", delta_color="inverse")
        with c4: st.metric("Wind Speed", f"{current_data_row['wind_kph']} km/h")
        
        st.markdown("### ğŸ“ˆ 30-Day Trend Analysis")
        
        # 2. Main Chart: Temperature vs Humidity (Dual Axis) - Xá»ŠN HÆ N
        fig_combo = make_subplots(specs=[[{"secondary_y": True}]])

        # Trace 1: Temperature (Area Chart - Gradient)
        fig_combo.add_trace(
            go.Scatter(x=df_history['date'], y=df_history['temp'], name="Temperature (Â°C)",
                       mode='lines', line=dict(color='#ff9f43', width=3), fill='tozeroy', fillcolor='rgba(255, 159, 67, 0.1)'),
            secondary_y=False
        )
        
        # Trace 2: Humidity (Bar Chart - Tháº¥p thoÃ¡ng phÃ­a sau)
        fig_combo.add_trace(
            go.Bar(x=df_history['date'], y=df_history['humidity'], name="Humidity (%)",
                   marker_color='rgba(52, 152, 219, 0.3)'),
            secondary_y=True
        )

        fig_combo.update_layout(
            template="plotly_dark", # Quan trá»ng: Dark theme cho chart
            title_text="Temperature vs Humidity Correlation",
            height=450,
            hovermode="x unified",
            paper_bgcolor='rgba(0,0,0,0)', # Trong suá»‘t ná»n
            plot_bgcolor='rgba(0,0,0,0)',
            legend=dict(orientation="h", y=1.1)
        )
        fig_combo.update_yaxes(title_text="Temperature (Â°C)", secondary_y=False, showgrid=True, gridcolor='#333')
        fig_combo.update_yaxes(title_text="Humidity (%)", secondary_y=True, showgrid=False)
        st.plotly_chart(fig_combo, use_container_width=True)
        
        # 3. Secondary Chart: Air Quality (PM2.5) Line Chart
        st.markdown("### ğŸŒ«ï¸ Air Quality History")
        fig_air = go.Figure()
        fig_air.add_trace(go.Scatter(
            x=df_history['date'], y=df_history['pm25'],
            mode='lines+markers',
            name='PM2.5',
            line=dict(color='#ef5777', width=2),
            marker=dict(size=6, color='#ef5777', line=dict(width=2, color='white'))
        ))
        
        # ThÃªm cÃ¡c váº¡ch ngÆ°á»¡ng nguy hiá»ƒm
        fig_air.add_hrect(y0=0, y1=12, line_width=0, fillcolor="green", opacity=0.1, annotation_text="Good")
        fig_air.add_hrect(y0=12, y1=35, line_width=0, fillcolor="yellow", opacity=0.1, annotation_text="Moderate")
        fig_air.add_hrect(y0=35, y1=100, line_width=0, fillcolor="red", opacity=0.1, annotation_text="Unhealthy")

        fig_air.update_layout(
            template="plotly_dark",
            height=350,
            paper_bgcolor='rgba(0,0,0,0)',
            plot_bgcolor='rgba(0,0,0,0)',
            xaxis_title="Date",
            yaxis_title="PM2.5 Concentration (Âµg/mÂ³)"
        )
        st.plotly_chart(fig_air, use_container_width=True)

    # === TAB 2: FORECAST ===
    with tab2:
        st.subheader("ğŸŒ¤ï¸ 24-Hour AI Forecast")
        
        # Logic dá»± bÃ¡o giáº£ láº­p (dá»±a trÃªn trend cuá»‘i cÃ¹ng cá»§a dá»¯ liá»‡u lá»‹ch sá»­)
        last_temp = df_history['temp'].iloc[-1]
        next_temp = last_temp + np.random.uniform(-1, 2)
        next_hum = max(0, min(100, current_data_row['humidity'] + np.random.uniform(-5, 5)))
        next_pm25 = max(0, current_data_row['air_quality_PM2.5'] + np.random.uniform(-5, 10))
        
        # Condition logic
        if next_hum > 80: condition = "Rainy ğŸŒ§ï¸"
        elif next_temp > 30: condition = "Sunny & Hot â˜€ï¸"
        elif next_pm25 > 50: condition = "Haze/Polluted ğŸŒ«ï¸"
        else: condition = "Cloudy â˜ï¸"

        # Display Forecast Cards
        col1, col2, col3, col4 = st.columns(4)
        col1.metric("Predicted Temp", f"{next_temp:.1f}Â°C", f"{(next_temp - last_temp):.1f}Â°C")
        col2.metric("Predicted Humidity", f"{next_hum:.0f}%")
        col3.metric("Predicted PM2.5", f"{next_pm25:.1f}")
        with col4:
            st.markdown(f"#### {condition}")
            
        # LÆ°u vÃ o session state Ä‘á»ƒ Tab 3 dÃ¹ng
        st.session_state['forecast'] = {'temp': next_temp, 'pm25': next_pm25, 'hum': next_hum}
        
        st.info("ğŸ’¡ Note: Forecast generated using heuristic projection based on 30-day historical trend analysis.")

    # === TAB 3: HEALTH PREDICTION ===
    with tab3:
        st.subheader("ğŸ¥ Disease Risk Prediction Model")
        
        if 'forecast' in st.session_state:
            f = st.session_state['forecast']
            
            # --- MODEL TRAINING (áº¨n bÃªn dÆ°á»›i) ---
            # Train model tháº­t vá»›i dataset 1
            X = df_health[['temperature_celsius', 'pm25_ugm3']]
            # Fill NaN náº¿u cÃ³ Ä‘á»ƒ trÃ¡nh lá»—i
            X = X.fillna(0)
            y_resp = df_health['respiratory_disease_rate']
            y_cardio = df_health['cardio_mortality_rate']
            
            model_resp = RandomForestRegressor(n_estimators=100).fit(X, y_resp)
            model_cardio = RandomForestRegressor(n_estimators=100).fit(X, y_cardio)
            
            # Predict
            input_val = pd.DataFrame([[f['temp'], f['pm25']]], columns=['temperature_celsius', 'pm25_ugm3'])
            risk_resp = model_resp.predict(input_val)[0]
            risk_cardio = model_cardio.predict(input_val)[0]
            
            # --- VISUALIZATION ---
            st.write("Predicted health risks per 100,000 population based on forecasted weather:")
            
            c1, c2 = st.columns(2)
            
            # Custom HTML Progress Bar cho Ä‘áº¹p
            def draw_risk(title, val, max_val, color):
                pct = min(100, (val/max_val)*100)
                st.markdown(f"""
                <div style="background-color: #1a1c24; padding: 20px; border-radius: 10px; border: 1px solid #333;">
                    <h4 style="margin:0; color: #eee;">{title}</h4>
                    <h2 style="margin: 5px 0; color: {color};">{val:.1f}</h2>
                    <div style="width: 100%; background-color: #333; height: 10px; border-radius: 5px; margin-top: 10px;">
                        <div style="width: {pct}%; background-color: {color}; height: 100%; border-radius: 5px;"></div>
                    </div>
                    <p style="margin-top: 5px; font-size: 0.8em; color: #888;">Threshold: {max_val}</p>
                </div>
                """, unsafe_allow_html=True)

            with c1:
                color = "#ff4757" if risk_resp > 30 else "#2ed573"
                draw_risk("ğŸ« Respiratory Disease Risk", risk_resp, 60, color)
                
            with c2:
                color = "#ffa502" if risk_cardio > 20 else "#2ed573"
                draw_risk("â¤ï¸ Cardiovascular Risk", risk_cardio, 50, color)
                
            st.markdown("---")
            st.markdown(f"**Analysis Basis:** Forecasted Temperature: **{f['temp']:.1f}Â°C** | PM2.5: **{f['pm25']:.1f} Âµg/mÂ³**")

        else:
            st.warning("Please check the Forecast tab first to generate data.")

else:
    st.info("Loading data...")



================================================
FILE: update-dataset.py
================================================
import os
from dotenv import load_dotenv
load_dotenv()

print("Updating dataset...")

# Thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng cho Kaggle API
os.environ['KAGGLE_USERNAME'] = os.getenv('KAGGLE_USERNAME')
os.environ['KAGGLE_KEY'] = os.getenv('KAGGLE_KEY')

# Táº¡o file cáº¥u hÃ¬nh cho Kaggle náº¿u chÆ°a cÃ³
kaggle_dir = os.path.expanduser('~/.kaggle')
os.makedirs(kaggle_dir, exist_ok=True)
with open(os.path.join(kaggle_dir, 'kaggle.json'), 'w') as f:
    import json
    json.dump({
        'username': os.environ['KAGGLE_USERNAME'],
        'key': os.environ['KAGGLE_KEY']
    }, f)
os.chmod(os.path.join(kaggle_dir, 'kaggle.json'), 0o600)

import kaggle

# Táº£i dataset (tá»± Ä‘á»™ng giáº£i nÃ©n)
kaggle.api.dataset_download_files(
    'nelgiriyewithana/global-weather-repository',  # Thay báº±ng dataset báº¡n muá»‘n
    path='./data',
    unzip=True
)

print("Finish!")


================================================
FILE: weather_information.ipynb
================================================
# Jupyter notebook converted to Python script.

"""
## Import thÆ° viá»‡n
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# TRAIN
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_squared_error, r2_score
from sklearn.ensemble import RandomForestRegressor

df = pd.read_csv('data/GlobalWeatherRepository.csv')
df.head()
df.columns
# Output:
#   Index(['country', 'location_name', 'latitude', 'longitude', 'timezone',

#          'last_updated_epoch', 'last_updated', 'temperature_celsius',

#          'temperature_fahrenheit', 'condition_text', 'wind_mph', 'wind_kph',

#          'wind_degree', 'wind_direction', 'pressure_mb', 'pressure_in',

#          'precip_mm', 'precip_in', 'humidity', 'cloud', 'feels_like_celsius',

#          'feels_like_fahrenheit', 'visibility_km', 'visibility_miles',

#          'uv_index', 'gust_mph', 'gust_kph', 'air_quality_Carbon_Monoxide',

#          'air_quality_Ozone', 'air_quality_Nitrogen_dioxide',

#          'air_quality_Sulphur_dioxide', 'air_quality_PM2.5', 'air_quality_PM10',

#          'air_quality_us-epa-index', 'air_quality_gb-defra-index', 'sunrise',

#          'sunset', 'moonrise', 'moonset', 'moon_phase', 'moon_illumination'],

#         dtype='object')

df['last_updated'] = pd.to_datetime(df['last_updated'])
daily_stats = df.groupby(df['last_updated'].dt.date).mean(numeric_only=True).tail(30)

# Láº¤Y THEO KHU Vá»°C
region = 'Vietnam'
df = df[(df['country'] == region) & (df['location_name'] == "Hanoi")]

fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(10, 8), sharex=True)

ax1.plot(daily_stats.index, daily_stats['temperature_celsius'], 'r-o')
ax1.set_ylabel('Nhiá»‡t Ä‘á»™ (Â°C)')
ax1.set_title('Nhiá»‡t Ä‘á»™ trung bÃ¬nh 30 ngÃ y')

ax2.plot(daily_stats.index, daily_stats['air_quality_PM2.5'], 'b-s')
ax2.set_ylabel('PM 2.5')
ax2.set_title('Cháº¥t lÆ°á»£ng khÃ´ng khÃ­ (PM 2.5) 30 ngÃ y')

plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
# Output:
#   <Figure size 1000x800 with 2 Axes>

# Äáº¿m sá»‘ láº§n xuáº¥t hiá»‡n cá»§a cÃ¡c loáº¡i thá»i tiáº¿t
condition_counts = df['condition_text'].value_counts().head(10)

# Váº½ biá»ƒu Ä‘á»“ cá»™t
condition_counts.plot(kind='barh', color='orange', figsize=(10, 5))
plt.title('Top 10 Ä‘iá»u kiá»‡n thá»i tiáº¿t phá»• biáº¿n nháº¥t')
plt.xlabel('Sá»‘ lÆ°á»£ng Ä‘á»‹a Ä‘iá»ƒm')
plt.show()
# Output:
#   <Figure size 1000x500 with 1 Axes>

"""
## MÃ´ hÃ¬nh dá»± Ä‘oÃ¡n
"""

# TRAIN MODEL
df['hour'] = df['last_updated'].dt.hour
features = ['latitude', 'humidity', 'pressure_mb', 'wind_kph', 'cloud', 'hour']
# data = df.sort_values('last_updated').tail(10000)
data = df.sort_values('last_updated')

X = data[features]
y = data['temperature_celsius']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
model = RandomForestRegressor(n_estimators=100, random_state=42) # n_estimators lÃ  sá»‘ cÃ¢y trong rá»«ng, random_state Ä‘á»ƒ tÃ¡i láº­p káº¿t quáº£
model.fit(X_train, y_train)

y_pred = model.predict(X_test)
rmse = np.sqrt(mean_squared_error(y_test, y_pred))
r2 = r2_score(y_test, y_pred)

print(f"RMSE: {rmse:.2f}Â°C | RÂ²: {r2:.2f}")
# Output:
#   RMSE: 1.77Â°C | RÂ²: 0.90


import matplotlib.pyplot as plt

plt.figure(figsize=(8, 6))
plt.scatter(y_test, y_pred, alpha=0.5, color='darkgreen')
plt.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], 'r--', lw=2)

plt.xlabel('Nhiá»‡t Ä‘á»™ thá»±c táº¿ (Â°C)')
plt.ylabel('Nhiá»‡t Ä‘á»™ dá»± Ä‘oÃ¡n (Â°C)')
plt.show()
# Output:
#   <Figure size 800x600 with 1 Axes>

import pandas as pd
feat_importances = pd.Series(model.feature_importances_, index=features)
feat_importances.nlargest(10).plot(kind='barh')
plt.title('Yáº¿u tá»‘ nÃ o áº£nh hÆ°á»Ÿng Ä‘áº¿n nhiá»‡t Ä‘á»™ nháº¥t?')
plt.show()
# Output:
#   <Figure size 640x480 with 1 Axes>

# Dá»± Ä‘oÃ¡n nhiá»‡t Ä‘á»™ má»›i dÃ¹ng dá»¯ liá»‡u realtime cá»§a open-metro
import requests
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from datetime import datetime

LAT, LON = 21.02, 105.83  # Tá»a Ä‘á»™ HÃ  Ná»™i
url = f"https://api.open-meteo.com/v1/forecast?latitude={LAT}&longitude={LON}&current=relative_humidity_2m,surface_pressure,wind_speed_10m,cloud_cover&timezone=auto"


response = requests.get(url)
data_json = response.json()
current = data_json['current']
new_data = pd.DataFrame([{
    'latitude': LAT,
    'humidity': current['relative_humidity_2m'],
    'pressure_mb': current['surface_pressure'],
    'wind_kph': current['wind_speed_10m'] * 3.6,  # m/s to km/h
    'cloud': current['cloud_cover'],
    'hour': datetime.now().hour
}])
new_data

predictions = model.predict(new_data)
print(f"Dá»± Ä‘oÃ¡n nhiá»‡t Ä‘á»™ (trung bÃ¬nh): {predictions[0]:.2f}Â°C")
print(f"Dá»± Ä‘oÃ¡n nhiá»‡t Ä‘á»™ (min): {(predictions[0] - rmse):.2f}Â°C")
print(f"Dá»± Ä‘oÃ¡n nhiá»‡t Ä‘á»™ (max): {(predictions[0] + rmse):.2f}Â°C")
# Output:
#   Dá»± Ä‘oÃ¡n nhiá»‡t Ä‘á»™ (trung bÃ¬nh): 20.35Â°C

#   Dá»± Ä‘oÃ¡n nhiá»‡t Ä‘á»™ (min): 18.57Â°C

#   Dá»± Ä‘oÃ¡n nhiá»‡t Ä‘á»™ (max): 22.12Â°C




================================================
FILE: data/global_climate_health_impact_tracker_2015_2025.csv
================================================
record_id,country_code,country_name,region,income_level,date,year,month,week,latitude,longitude,population_millions,temperature_celsius,temp_anomaly_celsius,precipitation_mm,heat_wave_days,drought_indicator,flood_indicator,extreme_weather_events,pm25_ugm3,air_quality_index,respiratory_disease_rate,cardio_mortality_rate,vector_disease_risk_score,waterborne_disease_incidents,heat_related_admissions,healthcare_access_index,gdp_per_capita_usd,mental_health_index,food_security_index
1,USA,United States,North America,High,2015-01-04,2015,1,1,37.09,-95.71,331,4.59,0.76,75.7,0,0,0,0,39.0,82.0,69.4,31.5,6.6,16.2,1.4,77.3,63627.0,71.2,90.2
2,USA,United States,North America,High,2015-01-11,2015,1,2,37.09,-95.71,331,3.13,-0.5,97.0,0,0,0,0,17.9,6.0,70.0,26.3,5.2,11.4,0.0,83.6,63627.0,70.6,94.0
3,USA,United States,North America,High,2015-01-18,2015,1,3,37.09,-95.71,331,3.99,-0.14,74.1,0,0,0,0,91.5,137.0,66.9,33.4,1.3,19.5,0.0,84.7,63627.0,63.4,100.0
4,USA,United States,North America,High,2015-01-25,2015,1,4,37.09,-95.71,331,6.43,-0.06,87.7,0,0,0,0,5.5,-3.0,47.0,35.0,6.0,9.7,9.0,84.3,63627.0,68.1,96.4
5,USA,United States,North America,High,2015-02-01,2015,2,5,37.09,-95.71,331,9.0,0.47,75.8,1,0,0,1,37.1,48.0,61.3,28.3,1.4,22.6,27.3,83.6,63733.0,69.1,100.0
6,USA,United States,North America,High,2015-02-08,2015,2,6,37.09,-95.71,331,6.44,0.18,151.0,0,0,0,0,114.1,157.0,80.2,30.6,0.7,23.7,11.9,78.0,63733.0,70.1,97.1
7,USA,United States,North America,High,2015-02-15,2015,2,7,37.09,-95.71,331,6.86,0.38,102.1,0,0,0,0,28.9,51.0,70.3,33.2,5.9,25.4,9.1,81.7,63733.0,68.5,100.0
8,USA,United States,North America,High,2015-02-22,2015,2,8,37.09,-95.71,331,8.34,0.64,102.9,1,0,0,1,0.0,5.0,48.0,33.3,6.4,17.7,20.3,86.7,63733.0,59.4,95.0
9,USA,United States,North America,High,2015-03-01,2015,3,9,37.09,-95.71,331,9.58,-0.83,82.2,0,0,0,0,18.8,29.0,80.3,24.9,5.9,18.3,7.8,84.9,63839.0,75.7,100.0
10,USA,United States,North America,High,2015-03-08,2015,3,10,37.09,-95.71,331,8.25,0.71,74.5,1,0,0,1,20.3,22.0,59.1,32.5,0.3,18.8,13.7,87.1,63839.0,71.9,95.2
11,USA,United States,North America,High,2015-03-15,2015,3,11,37.09,-95.71,331,8.83,-0.16,142.7,1,0,0,1,0.7,-23.0,54.1,32.0,7.3,12.3,13.6,83.2,63839.0,72.1,100.0
12,USA,United States,North America,High,2015-03-22,2015,3,12,37.09,-95.71,331,11.32,-0.34,126.3,0,0,0,0,40.4,73.0,63.9,22.2,8.1,25.1,20.8,79.1,63839.0,65.2,96.0
13,USA,United States,North America,High,2015-03-29,2015,3,13,37.09,-95.71,331,12.28,0.64,132.7,0,0,0,0,57.0,82.0,59.6,28.7,2.6,18.1,20.8,82.5,63839.0,71.4,100.0
14,USA,United States,North America,High,2015-04-05,2015,4,14,37.09,-95.71,331,13.64,-0.13,201.5,0,0,0,0,0.0,7.0,47.8,32.9,6.4,18.1,17.6,85.1,63945.0,62.4,97.5
15,USA,United States,North America,High,2015-04-12,2015,4,15,37.09,-95.71,331,11.04,-0.62,124.5,0,0,0,0,44.7,71.0,55.3,32.2,5.2,22.9,21.9,85.2,63945.0,65.2,100.0
16,USA,United States,North America,High,2015-04-19,2015,4,16,37.09,-95.71,331,9.17,0.16,125.9,1,0,0,1,70.8,106.0,86.5,37.2,5.7,19.4,15.1,79.9,63945.0,62.0,100.0
17,USA,United States,North America,High,2015-04-26,2015,4,17,37.09,-95.71,331,9.96,-0.26,62.8,0,0,0,0,56.4,77.0,77.8,29.0,1.8,14.9,17.8,82.6,63945.0,66.3,100.0
18,USA,United States,North America,High,2015-05-03,2015,5,18,37.09,-95.71,331,8.29,1.08,133.2,2,0,0,2,59.6,80.0,67.4,30.1,2.7,26.8,25.4,77.7,64051.0,67.4,100.0
19,USA,United States,North America,High,2015-05-10,2015,5,19,37.09,-95.71,331,10.93,0.64,122.7,1,0,0,1,76.7,104.0,62.2,33.5,10.6,18.4,19.7,76.5,64051.0,63.0,99.2
20,USA,United States,North America,High,2015-05-17,2015,5,20,37.09,-95.71,331,5.8,0.78,147.9,0,0,0,0,27.2,34.0,58.7,45.6,6.2,23.1,5.1,82.9,64051.0,70.3,100.0
21,USA,United States,North America,High,2015-05-24,2015,5,21,37.09,-95.71,331,3.88,0.65,86.2,0,0,0,0,95.6,154.0,79.4,35.4,4.7,16.1,3.3,80.6,64051.0,74.4,97.4
22,USA,United States,North America,High,2015-05-31,2015,5,22,37.09,-95.71,331,6.17,0.48,144.2,0,0,0,0,40.2,69.0,55.8,36.8,6.7,15.0,0.0,86.0,64051.0,63.9,96.4
23,USA,United States,North America,High,2015-06-07,2015,6,23,37.09,-95.71,331,9.14,-0.21,84.1,1,0,0,1,49.7,67.0,76.4,29.3,7.6,17.1,17.7,77.1,64157.0,79.1,100.0
24,USA,United States,North America,High,2015-06-14,2015,6,24,37.09,-95.71,331,4.24,0.61,56.0,0,0,0,0,68.1,112.0,63.4,33.0,0.0,27.4,1.4,86.6,64157.0,74.0,100.0
25,USA,United States,North America,High,2015-06-21,2015,6,25,37.09,-95.71,331,3.33,0.11,104.0,0,0,0,0,61.0,109.0,63.5,27.2,9.1,8.3,9.0,80.4,64157.0,68.5,99.7
26,USA,United States,North America,High,2015-06-28,2015,6,26,37.09,-95.71,331,3.14,0.65,105.5,0,0,0,0,51.2,78.0,50.9,29.0,4.0,20.8,1.1,82.7,64157.0,74.9,100.0
27,USA,United States,North America,High,2015-07-05,2015,7,27,37.09,-95.71,331,6.83,0.21,64.6,0,0,0,0,93.6,158.0,96.2,30.5,7.9,11.2,12.1,85.6,64263.0,69.2,93.0
28,USA,United States,North America,High,2015-07-12,2015,7,28,37.09,-95.71,331,-2.3,-0.94,83.7,0,0,0,0,57.5,101.0,74.7,32.7,7.1,17.8,0.0,79.2,64263.0,68.6,100.0
29,USA,United States,North America,High,2015-07-19,2015,7,29,37.09,-95.71,331,1.07,-0.03,76.4,0,0,0,0,51.7,41.0,56.5,29.3,4.8,19.8,0.0,81.6,64263.0,77.6,100.0
30,USA,United States,North America,High,2015-07-26,2015,7,30,37.09,-95.71,331,-3.72,-0.67,79.7,0,0,0,0,70.6,129.0,62.9,25.1,5.7,28.7,0.0,86.0,64263.0,77.8,100.0
31,USA,United States,North America,High,2015-08-02,2015,8,31,37.09,-95.71,331,0.68,0.1,28.7,0,1,0,1,47.5,81.0,77.9,25.7,7.1,23.8,0.0,81.7,64368.0,61.1,74.6
32,USA,United States,North America,High,2015-08-09,2015,8,32,37.09,-95.71,331,-0.73,0.76,57.6,0,0,0,0,89.2,113.0,59.7,33.5,6.2,18.3,0.0,84.5,64368.0,69.6,93.2
33,USA,United States,North America,High,2015-08-16,2015,8,33,37.09,-95.71,331,-2.15,-0.46,36.4,0,0,0,0,26.2,38.0,67.4,22.8,6.5,15.9,0.0,80.8,64368.0,69.5,94.6
34,USA,United States,North America,High,2015-08-23,2015,8,34,37.09,-95.71,331,-5.92,1.0,49.6,0,0,0,0,32.6,52.0,58.7,33.9,6.8,22.3,0.0,75.6,64368.0,67.1,98.4
35,USA,United States,North America,High,2015-08-30,2015,8,35,37.09,-95.71,331,-7.11,0.7,95.2,0,0,0,0,34.7,61.0,63.5,48.9,8.4,17.9,0.0,80.2,64368.0,62.0,100.0


================================================
FILE: data/GlobalWeatherRepository.csv
================================================
country,location_name,latitude,longitude,timezone,last_updated_epoch,last_updated,temperature_celsius,temperature_fahrenheit,condition_text,wind_mph,wind_kph,wind_degree,wind_direction,pressure_mb,pressure_in,precip_mm,precip_in,humidity,cloud,feels_like_celsius,feels_like_fahrenheit,visibility_km,visibility_miles,uv_index,gust_mph,gust_kph,air_quality_Carbon_Monoxide,air_quality_Ozone,air_quality_Nitrogen_dioxide,air_quality_Sulphur_dioxide,air_quality_PM2.5,air_quality_PM10,air_quality_us-epa-index,air_quality_gb-defra-index,sunrise,sunset,moonrise,moonset,moon_phase,moon_illumination
Afghanistan,Kabul,34.52,69.18,Asia/Kabul,1715849100,2024-05-16 13:15,26.6,79.8,Partly Cloudy,8.3,13.3,338,NNW,1012.0,29.89,0.0,0.0,24,30,25.3,77.5,10.0,6.0,7.0,9.5,15.3,277.0,103.0,1.1,0.2,8.4,26.6,1,1,04:50 AM,06:50 PM,12:12 PM,01:11 AM,Waxing Gibbous,55
Albania,Tirana,41.33,19.82,Europe/Tirane,1715849100,2024-05-16 10:45,19.0,66.2,Partly cloudy,6.9,11.2,320,NW,1012.0,29.88,0.1,0.0,94,75,19.0,66.2,10.0,6.0,5.0,11.4,18.4,193.6,97.3,0.9,0.1,1.1,2.0,1,1,05:21 AM,07:54 PM,12:58 PM,02:14 AM,Waxing Gibbous,55
Algeria,Algiers,36.76,3.05,Africa/Algiers,1715849100,2024-05-16 09:45,23.0,73.4,Sunny,9.4,15.1,280,W,1011.0,29.85,0.0,0.0,29,0,24.6,76.4,10.0,6.0,5.0,13.9,22.3,540.7,12.2,65.1,13.4,10.4,18.4,1,1,05:40 AM,07:50 PM,01:15 PM,02:14 AM,Waxing Gibbous,55
Andorra,Andorra La Vella,42.5,1.52,Europe/Andorra,1715849100,2024-05-16 10:45,6.3,43.3,Light drizzle,7.4,11.9,215,SW,1007.0,29.75,0.3,0.01,61,100,3.8,38.9,2.0,1.0,2.0,8.5,13.7,170.2,64.4,1.6,0.2,0.7,0.9,1,1,06:31 AM,09:11 PM,02:12 PM,03:31 AM,Waxing Gibbous,55
Angola,Luanda,-8.84,13.23,Africa/Luanda,1715849100,2024-05-16 09:45,26.0,78.8,Partly cloudy,8.1,13.0,150,SSE,1011.0,29.85,0.0,0.0,89,50,28.7,83.6,10.0,6.0,8.0,12.5,20.2,2964.0,19.0,72.7,31.5,183.4,262.3,5,10,06:12 AM,05:55 PM,01:17 PM,12:38 AM,Waxing Gibbous,55
Antigua and Barbuda,Saint John's,17.12,-61.85,America/Antigua,1715849100,2024-05-16 04:45,26.0,78.8,Partly cloudy,5.6,9.0,90,E,1013.0,29.91,0.02,0.0,84,25,28.2,82.8,10.0,6.0,1.0,15.7,25.3,220.3,29.0,0.2,0.2,1.2,4.5,1,1,05:36 AM,06:32 PM,01:05 PM,01:14 AM,Waxing Gibbous,55
Argentina,Buenos Aires,-34.59,-58.67,America/Argentina/Buenos_Aires,1715849100,2024-05-16 05:45,8.0,46.4,Clear,2.2,3.6,10,N,1014.0,29.94,0.0,0.0,93,0,7.1,44.9,10.0,6.0,1.0,6.5,10.5,270.4,7.7,8.3,1.3,4.0,5.3,1,1,07:43 AM,05:59 PM,02:36 PM,01:04 AM,Waxing Gibbous,55
Armenia,Yerevan,40.18,44.51,Asia/Yerevan,1715849100,2024-05-16 12:45,19.0,66.2,Partly cloudy,4.3,6.8,140,SE,1017.0,30.03,0.13,0.01,40,25,19.0,66.2,10.0,6.0,4.0,6.2,9.9,186.9,103.0,1.0,0.3,0.8,0.9,1,1,05:45 AM,08:12 PM,01:17 PM,02:31 AM,Waxing Gibbous,55
Australia,Canberra,-35.28,149.22,Australia/Sydney,1715849100,2024-05-16 18:45,9.0,48.2,Clear,2.5,4.0,100,E,1027.0,30.33,0.0,0.0,87,0,9.1,48.5,10.0,6.0,1.0,3.3,5.3,277.0,26.8,15.1,1.0,3.7,5.4,1,1,06:52 AM,05:07 PM,01:31 PM,No moonset,Waxing Gibbous,55